(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(f){var a=/\+/g;function d(j){return b.raw?j:encodeURIComponent(j)}function g(j){return b.raw?j:decodeURIComponent(j)}function h(j){return d(b.json?JSON.stringify(j):String(j))}function c(j){if(j.indexOf('"')===0){j=j.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{j=decodeURIComponent(j.replace(a," "))}catch(k){return}try{return b.json?JSON.parse(j):j}catch(k){}}function e(k,j){var l=b.raw?k:c(k);return f.isFunction(j)?j(l):l}var b=f.cookie=function(q,p,v){if(p!==undefined&&!f.isFunction(p)){v=f.extend({},b.defaults,v);if(typeof v.expires==="number"){var r=v.expires,u=v.expires=new Date();u.setDate(u.getDate()+r)}return(document.cookie=[d(q),"=",h(p),v.expires?"; expires="+v.expires.toUTCString():"",v.path?"; path="+v.path:"",v.domain?"; domain="+v.domain:"",v.secure?"; secure":""].join(""))}var w=q?undefined:{};var s=document.cookie?document.cookie.split("; "):[];for(var o=0,m=s.length;o<m;o++){var n=s[o].split("=");var j=g(n.shift());var k=n.join("=");if(q&&q===j){w=e(k,p);break}if(!q&&(k=e(k))!==undefined){w[j]=k}}return w};b.defaults={};f.removeCookie=function(k,j){if(f.cookie(k)!==undefined){f.cookie(k,"",f.extend({},j,{expires:-1}));return true}return false}}));(function(b){if(typeof define==="function"&&define.amd){define(["jquery"],b)}else{if(typeof exports==="object"){b(require("jquery"))}else{b(jQuery)}}}(function(y){var B="ls_";var u="ss_";function x(h){var b=arguments.length,d=window[h],e=arguments,c=e[1],l,f,j;if(b<2){throw new Error("Minimum 2 arguments must be given")}else{if(y.isArray(c)){f={};for(var k in c){l=c[k];try{f[l]=JSON.parse(d.getItem(l))}catch(g){f[l]=d.getItem(l)}}return f}else{if(b==2){try{return JSON.parse(d.getItem(c))}catch(g){return d.getItem(c)}}else{try{f=JSON.parse(d.getItem(c))}catch(g){throw new ReferenceError(c+" is not defined in this storage")}for(var k=2;k<b-1;k++){f=f[e[k]];if(f===undefined){throw new ReferenceError([].slice.call(e,1,k+1).join(".")+" is not defined in this storage")}}if(y.isArray(e[k])){j=f;f={};for(var a in e[k]){f[e[k][a]]=j[e[k][a]]}return f}else{return f[e[k]]}}}}}function D(g){var a=arguments.length,d=window[g],e=arguments,b=e[1],c=e[2],l,k={},h;if(a<2||!y.isPlainObject(b)&&a<3){throw new Error("Minimum 3 arguments must be given or second parameter must be an object")}else{if(y.isPlainObject(b)){for(var j in b){l=b[j];if(!y.isPlainObject(l)){d.setItem(j,l)}else{d.setItem(j,JSON.stringify(l))}}return b}else{if(a==3){if(typeof c==="object"){d.setItem(b,JSON.stringify(c))}else{d.setItem(b,c)}return c}else{try{h=d.getItem(b);if(h!=null){k=JSON.parse(h)}}catch(f){}h=k;for(var j=2;j<a-2;j++){l=e[j];if(!h[l]||!y.isPlainObject(h[l])){h[l]={}}h=h[l]}h[e[j]]=e[j+1];d.setItem(b,JSON.stringify(k));return k}}}}function p(g){var b=arguments.length,d=window[g],e=arguments,c=e[1],k,j;if(b<2){throw new Error("Minimum 2 arguments must be given")}else{if(y.isArray(c)){for(var h in c){d.removeItem(c[h])}return true}else{if(b==2){d.removeItem(c);return true}else{try{k=j=JSON.parse(d.getItem(c))}catch(f){throw new ReferenceError(c+" is not defined in this storage")}for(var h=2;h<b-1;h++){j=j[e[h]];if(j===undefined){throw new ReferenceError([].slice.call(e,1,h).join(".")+" is not defined in this storage")}}if(y.isArray(e[h])){for(var a in e[h]){delete j[e[h][a]]}}else{delete j[e[h]]}d.setItem(c,JSON.stringify(k));return true}}}}function v(a,d){var b=r(a);for(var c in b){p(a,b[c])}if(d){for(var c in y.namespaceStorages){z(c)}}}function t(h){var e=arguments.length,f=arguments,b=window[h],g=f[1];if(e==1){return(r(h).length==0)}else{if(y.isArray(g)){for(var c=0;c<g.length;c++){if(!t(h,g[c])){return false}}return true}else{try{var d=x.apply(this,arguments);if(!y.isArray(f[e-1])){d={totest:d}}for(var c in d){if(!((y.isPlainObject(d[c])&&y.isEmptyObject(d[c]))||(y.isArray(d[c])&&!d[c].length)||(!d[c]))){return false}}return true}catch(a){return true}}}}function q(h){var e=arguments.length,f=arguments,b=window[h],g=f[1];if(e<2){throw new Error("Minimum 2 arguments must be given")}if(y.isArray(g)){for(var c=0;c<g.length;c++){if(!q(h,g[c])){return false}}return true}else{try{var d=x.apply(this,arguments);if(!y.isArray(f[e-1])){d={totest:d}}for(var c in d){if(!(d[c]!==undefined&&d[c]!==null)){return false}}return true}catch(a){return false}}}function r(h){var a=arguments.length,d=window[h],g=arguments,c=g[1],e=[],b={};if(a>1){b=x.apply(this,g)}else{b=d}if(b&&b._cookie){for(var f in y.cookie()){if(f!=""){e.push(f.replace(b._prefix,""))}}}else{for(var j in b){e.push(j)}}return e}function z(b){if(!b||typeof b!="string"){throw new Error("First parameter must be a string")}if(s){if(!window.localStorage.getItem(b)){window.localStorage.setItem(b,"{}")}if(!window.sessionStorage.getItem(b)){window.sessionStorage.setItem(b,"{}")}}else{if(!window.localCookieStorage.getItem(b)){window.localCookieStorage.setItem(b,"{}")}if(!window.sessionCookieStorage.getItem(b)){window.sessionCookieStorage.setItem(b,"{}")}}var a={localStorage:y.extend({},y.localStorage,{_ns:b}),sessionStorage:y.extend({},y.sessionStorage,{_ns:b})};if(y.cookie){if(!window.cookieStorage.getItem(b)){window.cookieStorage.setItem(b,"{}")}a.cookieStorage=y.extend({},y.cookieStorage,{_ns:b})}y.namespaceStorages[b]=a;return a}function A(c){if(!window[c]){return false}var a="jsapi";try{window[c].setItem(a,a);window[c].removeItem(a);return true}catch(b){return false}}var s=A("localStorage");var w={_type:"",_ns:"",_callMethod:function(b,d){var a=[this._type],d=Array.prototype.slice.call(d),c=d[0];if(this._ns){a.push(this._ns)}if(typeof c==="string"&&c.indexOf(".")!==-1){d.shift();[].unshift.apply(d,c.split("."))}[].push.apply(a,d);return b.apply(this,a)},get:function(){return this._callMethod(x,arguments)},set:function(){var d=arguments.length,e=arguments,c=e[0];if(d<1||!y.isPlainObject(c)&&d<2){throw new Error("Minimum 2 arguments must be given or first parameter must be an object")}if(y.isPlainObject(c)&&this._ns){for(var b in c){D(this._type,this._ns,b,c[b])}return c}else{var a=this._callMethod(D,e);if(this._ns){return a[c.split(".")[0]]}else{return a}}},remove:function(){if(arguments.length<1){throw new Error("Minimum 1 argument must be given")}return this._callMethod(p,arguments)},removeAll:function(a){if(this._ns){D(this._type,this._ns,{});return true}else{return v(this._type,a)}},isEmpty:function(){return this._callMethod(t,arguments)},isSet:function(){if(arguments.length<1){throw new Error("Minimum 1 argument must be given")}return this._callMethod(q,arguments)},keys:function(){return this._callMethod(r,arguments)}};if(y.cookie){if(!window.name){window.name=Math.floor(Math.random()*100000000)}var C={_cookie:true,_prefix:"",_expires:null,_path:null,_domain:null,setItem:function(a,b){y.cookie(this._prefix+a,b,{expires:this._expires,path:this._path,domain:this._domain})},getItem:function(a){return y.cookie(this._prefix+a)},removeItem:function(a){return y.removeCookie(this._prefix+a)},clear:function(){for(var a in y.cookie()){if(a!=""){if(!this._prefix&&a.indexOf(B)===-1&&a.indexOf(u)===-1||this._prefix&&a.indexOf(this._prefix)===0){y.removeCookie(a)}}}},setExpires:function(a){this._expires=a;return this},setPath:function(a){this._path=a;return this},setDomain:function(a){this._domain=a;return this},setConf:function(a){if(a.path){this._path=a.path}if(a.domain){this._domain=a.domain}if(a.expires){this._expires=a.expires}return this},setDefaultConf:function(){this._path=this._domain=this._expires=null}};if(!s){window.localCookieStorage=y.extend({},C,{_prefix:B,_expires:365*10});window.sessionCookieStorage=y.extend({},C,{_prefix:u+window.name+"_"})}window.cookieStorage=y.extend({},C);y.cookieStorage=y.extend({},w,{_type:"cookieStorage",setExpires:function(a){window.cookieStorage.setExpires(a);return this},setPath:function(a){window.cookieStorage.setPath(a);return this},setDomain:function(a){window.cookieStorage.setDomain(a);return this},setConf:function(a){window.cookieStorage.setConf(a);return this},setDefaultConf:function(){window.cookieStorage.setDefaultConf();return this}})}y.initNamespaceStorage=function(a){return z(a)};if(s){y.localStorage=y.extend({},w,{_type:"localStorage"});y.sessionStorage=y.extend({},w,{_type:"sessionStorage"})}else{y.localStorage=y.extend({},w,{_type:"localCookieStorage"});y.sessionStorage=y.extend({},w,{_type:"sessionCookieStorage"})}y.namespaceStorages={};y.removeAllStorages=function(a){y.localStorage.removeAll(a);y.sessionStorage.removeAll(a);if(y.cookieStorage){y.cookieStorage.removeAll(a)}if(!a){y.namespaceStorages={}}}}));$.Class("application",{viewport:null},{init:function(a){this.rootPath=a;this.viewport=new Viewport(this);this.toolbar=new Toolbar(this);this.toolbox=new Toolbox(this);this.facebook=new Facebook(this);this.googleplus=new GooglePlus(this);this._setAjaxUpload()},action:function(a,b){if(a=="tb"){this.toolbox.toolbarBtn(b)}if(a=="option"){this.toolbox.optionChanged(b)}if(a=="font"){this.toolbox.setFont(b)}},_showLoading:function(){var b=$("#cover");var a=$("#canvas");b.show();b.offset(a.offset());b.width(a.outerWidth());b.height(a.outerHeight())},_hideLoading:function(){$("#cover").hide()},getCustomToolbox:function(a,b){this.ajax("editor",a,[],b)},notifyUser:function(c,b,a){if(this.popup){this.popup.destroy()}this.popup=new iBox(this,"./?fa=info&action="+c+"&width="+b+"&height="+a,["auto","auto"]);this.popup.wrapper.css("zIndex",100)},showMessage:function(a){$.colorbox({html:a})},removeNotify:function(){if(this.popup){this.popup.destroy()}this.popup=null},_showError:function(a){alert("error")},loggedin:function(a){return this.toolbox.loggedin(a)},ajax:function(c,g){var b=this;var g=g||false;var d=c.success;var a=c.error;var e=c.data;var f=c.ajax_fa;if(!g){b._showLoading()}c.error=function(h){if(h.statusText.indexOf("timeout")>=0){return}if(!g){b._hideLoading()}if(h.responseText.indexOf("AJAX:SESSION_EXPIRED")>=0){location.href="index.cfm?fuseaction=login.logout"}else{b.sendError(e,f);alert('An error occurred. Please try again. If it continues, "delete" the image and upload again.')}if(a){a(h)}};c.success=function(h){if(typeof(h)=="string"&&(h.indexOf("AJAX:SESSION_EXPIRED")>=0)){location.href="index.cfm?fuseaction=login.logout"}else{if(d){d(h)}}};$.ajax(c)},sendError:function(b,a){b.fa_request=b.fa;b.ajax_fa=a;$.ajax({type:"POST",url:"./index.cfm?fa=log_error",timeout:1000,data:b})},getHTML:function(c,b,d){var a=this;$.ajax({type:"GET",url:"./index.cfm?fa="+c+"&action="+b,timeout:30000,success:d,error:function(){alert("error occurred")}})},_setAjaxUpload:function(){var a=this;$("#OverlayUploadForm").submit(function(){$(this).ajaxSubmit({success:function(c,b,e,d){a.toolbox.ajaxUploadReady(c)},error:function(b){a.toolbox.ajaxUploadError(b)}});return false})}});$.fn.hideOption=function(){this.each(function(){$(this).wrap("<span>").hide()})};$.fn.showOption=function(){this.each(function(){var a=$(this).show();$(this).parent().replaceWith(a)})};(function(a){a(document).ajaxSend(function(c,d,b){if(typeof _gaq!=="undefined"&&_gaq!==null){_gaq.push(["_trackPageview",b.url])}})})(jQuery);$.Class("Viewport",{canvas:null,app:null,main:null},{init:function(a){this.app=a;this.canvas=$("#canvas");this._initMainImage();this._initTextLayer()},_initTextLayer:function(){$("#textDiv").draggable({appentTo:"parent"})},_initMainImage:function(){this.main=new ImageLayer(this);this.main.loadImages(data)}});$.Class("Toolbox",{app:null,action:null,current_layer:null},{init:function(a){this.app=a;this.image_layer=a.viewport.main;this.keepEditor=false;this._addTools();this._bindElements();this._initSliders();this._initColors($(".colorSlider"));this._initRotation();this._initCircle();this._initSpinners();this._showDefault();this._initUndoRedo();this._initStorage();$(".tb").show();this._initApi()},_initApi:function(){if(!data.action){return}var a=$("#"+data.action).get(0);var b=$("#tab_"+data.tab).get(0);this.toolbarBtn(b,true);this.toolbarBtn(a,false)},_initSpinners:function(){var a=this;$("#shadow_fall").spinner({max:5,min:-5,stop:function(b,c){a._optionChanged($(this))}})},_initUndoRedo:function(a){var a=a||data;this.currentIndex=a.index;this.totalIndex=a.totals;this.setUndoRedo()},_initStorage:function(){this.storage=new Storage()},setUndoRedo:function(a){(this.currentIndex>1)?$("#btnUndo").addClass("active"):$("#btnUndo").removeClass("active");(this.currentIndex<this.totalIndex)?$("#btnRedo").addClass("active"):$("#btnRedo").removeClass("active")},_bindElements:function(){var a=this;$(".tbInput").change(function(){a._optionChanged($(this))});$(".tbClick").click(function(){a._optionChanged($(this))});$(".tbAction").click(function(){a._performButton($(this),true)});$(".tbPerform").click(function(){a._performButton($(this))});$(".tbClear").focus(function(){a._clearOnFocus($(this))});$(".tbApply").click(function(){a._apply()});$(".storage").click(function(){a._storage($(this))});$(".colorPicker").bind("click",function(b){a._pickColorPrepare($(this))})},_showDefault:function(){if(this.current_layer){this.current_layer.destroy()}this._hideTools();$("#tb_title").html($("#tb_oie_title").html());$("#tb_explain").html($("#tb_oie_explain").html());$("#tb_title").show();$("#tb_explain").show();this.help=""},ajaxUploadReady:function(a){this.current_layer.ajaxUploadReady(a)},ajaxUploadError:function(a){alert("There was an error uploading the image! Maybe filesize is to big (Max 5MB)")},_catchResult:function(b){var a=this;if(b.error!=""){a.app._hideLoading();return a.app.showMessage(b.error)}if(b.refresh==true){return a._reloadPage()}a.image_layer.loadImages(b);a.image_layer.reset();a._initUndoRedo(b);if(a.keepEditor){if(a.current_layer){a.current_layer.postRequest()}return}a._destroyCurrent();a._showDefault()},_apply:function(d,c){var a=this;var d=d||{};var c=c||a.action;d.img_data=a.image_layer.getData();if(a.current_layer){d.other_data=a.current_layer.getData()}d.tb_data=a._getOwnData();var b={fa:c,data:$.toJSON(d)};a.app.ajax({success:function(e){a._catchResult(e)},type:"POST",url:"ajaxindex.cfm",dataType:"json",data:b})},_getOwnData:function(){var a=$(".tb input, .tb select");var b={};$.each(a,function(c,e){var d=$(e);if(d.is(":visible")){if(d.is(":checkbox")){b[e.id]=d.is(":checked")}else{b[e.id]=d.val()}}});return b},_optionChanged:function(a){if(this.current_layer){this.current_layer.change(a)}this.image_layer.change(a);Settings.change(a);return},_storage:function(a){this.storage.action(a,this.action,this.current_layer)},_fireAction:function(element){var tool=element.attr("id");this.action=tool;var new_func_str="this._action"+tool+"(element)";try{eval(new_func_str)}catch(e){}},_clearOnFocus:function(a){if(a.attr("name")==a.val()){a.val("")}},_initCircle:function(){var a=$("#arc_val");for(var b=0;b<=360;b=b+10){a.append($("<option>",{value:b,text:b}))}},_initRotation:function(){var a=$("#rotation");for(var b=0;b<360;b++){a.append($("<option>",{value:b,text:b}))}},_colorInputChanged:function(d){var c=$(d);var b=c.spectrum("get");var e=c.val();var a=tinycolor(e);if(a.ok&&b.toHex()!=a.toHex()){c.spectrum("set",a);this._optionChanged(c)}},_colorSelectionChanged:function(c,a){var b=$(c);b.val(a.toHex(true));b.trigger("change");this._optionChanged(b)},_colorOpacityChanged:function(d,a){var c=$(d);var e=c.attr("id");var b=$("#fg_opacity");if(e=="bg_color"){b=$("#bg_opacity")}else{if(e=="shadow_color"){b=$("#shadow_opacity")}}b.val(a.alpha);this._optionChanged(b)},_initColors:function(b){var a=this;b.spectrum({clickoutFiresChange:true,localStorageKey:"fg_color",showButtons:true,showPalette:true,showAlpha:true,cancelText:"",chooseText:"",preferredFormat:"hex",change:function(c){a._colorSelectionChanged(this,c)},mouseup:function(c){a._colorSelectionChanged(this,c)},alphaMove:function(c){a._colorOpacityChanged(this,c)},palette:[["FF0000","008000","008080","00FF00"],["000080","00BFFF","00FFFF","ACDEFF"],["A52A2A","B22222","8B4513","FFA500"],["800080","8A2BE2","FF1493","FFC0CB"],["D4AF37","FFD700","FFFF00","F5F5DC"],["000000","C0C0C0","7E7E7E","FFFFFF"]]});b.show();b.keyup(function(){a._colorInputChanged(this)})},_sliderEvent:function(a,b){var c=b.handle.parentElement.id;if(c=="fg_slider"){this.image_layer.resizeSlideImage(a,b,this.action=="resize")}else{this.current_layer.resizeSlideImage(a,b)}},_initSliders:function(){var a=this;$(".zoom_slider").width(215).slider({value:100,min:10,max:200,stop:function(b,c){a._sliderEvent(b,c)},slide:function(b,c){a._sliderEvent(b,c)}});$(".opacity_slider").width(215).slider({value:100,min:1,max:100,slide:function(b,c){a._sliderEvent(b,c)}})},showUpload:function(){var a=this;if(a.uploader){a.uploader.dialog("open");return}a.app.getHTML("editor","upload",function(b){a.showUploader(b)})},showUploader:function(a){var b=this;if(!b.uploader){b.uploader=$('<div id="dialog"></div>')}b.uploader.html(a);b.uploader.dialog({height:"auto",width:"auto",modal:false,position:{my:"left top",at:"right top",of:$("#upload")}});b.uploader.tabs({heightStyle:"auto"});b._bindActions("#dialog")},_bindActions:function(b){var a=this;$(b+" .action").bind("click",function(c){a._fireAction($(this))});$(b+" .perform").bind("click",function(c){a._optionChanged($(this))});$(b+" .change").change(function(c){a._optionChanged($(this))});$(b+" .colorPicker").bind("click",function(c){a._pickColorPrepare($(this))});$(b+" .storage").click(function(){a._storage($(this))});this._initColors($(b+" .colorPick"))},_pickColorPrepare:function(b){var a=this;var d=$(b).attr("id").replace("_picker","");var c=function(e){a._pixelSelected(e,d)};if(this.picker_info){$("#img").unbind("click")}if(this.picker_info){this.picker_info.destroy()}this.picker_info=new iBox(this,"./?fa=info&action=start_color_pick",["auto","auto"]);this.catcher=new Catcher(this,c)},_pickColorCancel:function(){if(this.picker_info){$("#img").unbind("click")}this.picker_info.destroy();this.catcher.destroy()},_pixelSelected:function(d,e){var a=this;var d=a.catcher.lastClick;a._pickColorCancel();var c="get_pixel_colour";var b={fa:c,data:$.toJSON(d)};a.app.ajax({success:function(f){a._pickColorResult(f,e)},type:"POST",url:"ajaxindex.cfm",dataType:"json",data:b},true)},_pickColorResult:function(b,c){var a=$("#"+c);a.spectrum("set",b.color);this._optionChanged(a)},showCustomToolbox:function(a){var b=this;$("#DynaContent").html(a);this._bindActions("#DynaContent");ik=this.current_layer;if(this.current_layer!=null){this.current_layer.postLoadEditor()}},setFont:function(a){$("#font").val(a.attr("id"));if(this.fontDialog){this.fontDialog.dialog("close")}$("#font").trigger("change")},loggedin:function(a){this.refreshFonts();if(a=="your_fonts"){this.showFontDialog(true);return true}},refreshFonts:function(){this.app.ajax({type:"GET",url:"index.cfm?random="+Math.random(),data:{fa:"get_font_options"},success:function(a){$("#font").html(a)}},true)},trackFontFrame:function(a){this.fontUrl=a.contentWindow.location},showFontDialog:function(b){var a=this;var b=b||false;if(b){$("#fontContent").attr("src",this.fontUrl)}if(!this.fontDialog){this.fontDialog=$("<div id='fontDialog'><iframe id='fontContent' /></div>")}else{return this.fontDialog.dialog("open")}var c=this.fontDialog;this.fontDialog.dialog({autoOpen:false,height:"auto",width:"auto",position:"top",modal:true,load:function(){a.trackFontFrame(this)},open:function(d,e){$("#fontDialog").css("overflow-y","hidden")},resize:function(f,g){var e=parseInt(c.css("width"))-6;var d=parseInt(c.css("height"));$("#fontContent").css("width",e).css("height",d)}});this.fontUrl=app.rootPath+"/fonts/?image=top100";$("#fontContent").load(function(){a.trackFontFrame(this)});$("#fontContent").attr("src",this.fontUrl);this.fontDialog.dialog("open")},_removeDynaContent:function(){$("#DynaContent").html("")},_reloadPage:function(){window.location.reload()},_showhelp_pages:function(){this._showHelp(true)},_showsettings:function(){Settings.show()},_actiondownload:function(){this.download()},_actionto_partner:function(){this.upload_to_partner()},_actionfacebook:function(){this.app.facebook.login("get_album_photos")},_actionfacebookupload:function(){this.app.facebook.login("show_upload")},_actiongoogleupload:function(){this.app.googleplus.login("show_upload")},_actiongoogle_plus:function(){this.app.googleplus.login("get_album_photos")},_actionrotate:function(a){this.keepEditor=true;var b={};b.rotation=a.attr("class").split(" ")[0];this._apply(b)},_actionmirror:function(a){this.keepEditor=true;var b={};b.rotation=a.attr("class").split(" ")[0];this._apply(b)},_actionadjustment:function(a){var b={};b.adjust=a.attr("class").split(" ")[0];this._apply(b)},_actiongif_only:function(a){var b={};b.action=a.attr("class").split(" ")[0];this._apply(b)},_actionremove_transparency:function(a){var b={};this._apply(b)},_actioncreate_canvas:function(){CanvasCreation.go()},_actionfilltype:function(){CanvasCreation.changedFillType()},_showquestion:function(){this._showHelp()},_showbtnCancel:function(){this._showDefault()},_showdelete_image:function(){var a=this;this.app.ajax({type:"POST",url:"index.cfm",data:{fa:"delete_image"},success:function(b){a._reloadPage()}})},_hidesave_image:function(){app.facebook.destroy()},_showprevious:function(){this._apply(null,"previous")},_shownext:function(){this._apply(null,"next")},_showresize:function(){var a=$("#aspect").is(":checked");this.image_layer.addClipbox("resize",a)},_hideresize:function(){this.image_layer.removeClipbox();this.image_layer.setOriginalSize();this._initSliders()},_showcrop_frame:function(){this.image_layer.addClipbox("crop")},_hidecrop_frame:function(){this.image_layer.removeClipbox()},_showset_border:function(){this.current_layer=new Overlay(this)},_showpasse_partout:function(){this.current_layer=new Vignette(this)},_showpicture_frames:function(){this.current_layer=new Photoborder(this)},_showround_border:function(){this.current_layer=new Roundborder(this)},_showtrim_image:function(){this.current_layer=new TrimImage(this)},_showanimated_mask:function(){this.current_layer=new Floaties(this)},_showglitters:function(){this.keepEditor=true;this.current_layer=new Glitter(this,this._apply)},_showstars:function(){this.current_layer=new Stars(this)},_showoverlay_image:function(){this.current_layer=new OverlayImage(this)},_showtransparency:function(){this.keepEditor=true;this.current_layer=new Transparency(this,this._apply)},_showadd_flag:function(){var a=this;this.current_layer=new Flags(this)},_showlolcats:function(){this.action="theme_text";this.current_layer=new TextThemes(this,"lolcats")},_showglittertext:function(){this.keepEditor=true;this.action="theme_text";this.current_layer=new GlitterText(this)},_showcreate_text:function(){this.keepEditor=true;this.current_layer=new TextLayer(this)},_showspeechbubble:function(){this.keepEditor=true;this.current_layer=new SpeechBubble(this)},_showimage_in_text:function(){this.action="theme_text";this.current_layer=new ImageText(this)},_showexpand_canvas:function(){this.current_layer=new ExpandCanvas(this)},_showrain:function(){this.current_layer=new RainEffect(this)},_showfontxml:function(){this.showFontDialog()},_showDynamic:function(b){var a=this;this.app.getHTML("editor",b,function(c){a.showCustomToolbox(c)})},_showupload:function(){var a=this;this.showUpload()},_showtab_basic:function(a){$(".tab").removeClass("focus");a.addClass("focus");$(".buttonrow").hide();$("#basic_btns").show()},_showtab_wizard:function(a){$(".tab").removeClass("focus");a.addClass("focus");$(".buttonrow").hide();$("#wizard_btns").show()},_showtab_2013:function(a){$(".tab").removeClass("focus");a.addClass("focus");$(".buttonrow").hide();$("#new_btns").show()},_showffilter:function(){this.showFontDialog()},_showfspace:function(){$("#line_spacing").show().position({my:"left top",at:"right top",of:$("#fspace")}).mouseleave(function(a){$(a.currentTarget).hide()})},_showfkerning:function(){$("#txt_kerning").show().position({my:"left center",at:"right top",of:$("#fkerning")}).mouseleave(function(a){$(a.currentTarget).hide()})},_showfsymbols:function(){$("#txt_symbols").show().position({my:"left top",at:"right top",of:$("#fsymbols")}).mouseleave(function(a){$(a.currentTarget).hide()})},_showshadow_mover:function(){this.current_layer._setMover()},_showanimation_generator:function(a){window.location="./gifmaker/"},_showadd_to_animation:function(a){data={};var b={fa:"ajaxResponse",ajax_fa:"add_to_ani_sequence_quietly",data:$.toJSON(data)};this.app.ajax({success:function(c){a.find("#frame_count").html(c.frame_count)},type:"POST",url:"index.cfm",dataType:"json",data:b},true)},_showHelp:function(c){var d="./help/";if(this.help&&c!=true){d+="?help_id="+this.help}var b=window.open(d,"online_image_editor_help_window","width=1200,height=800,scrollbars=1");b.focus()},_destroyCurrent:function(){if(!this.current_layer){return}this.current_layer.destroy();this.current_layer=null;app.removeNotify()},_addTools:function(){this.tools={save_image:"tbDynamic",previous:"",next:"",clear_images:"",resize:"tbFgResize,tbWidth,tbHeight,tbAspect,tbApply,tbAdd",crop_frame:"tbWidth,tbHeight,tbOffsetX,tbOffsetY,tbApply,tbAdd",create_text:"tbTextInput,tbFont,tbFgColor,tbBgColor,tbStrokeWidth,font_arc,tbSize,tbRotation,tbShadow,tbApply,tbStorage",rotate_flip:"tbDynamic",colour_adjustment:"tbDynamic",set_border:"tbBorderType,tbBorderWidth,tbFgColor,tbApply,tbAdd",passe_partout:"tbDynamic,tbFgColor,tbApply",picture_frames:"tbDynamic",round_border:"tbBorderRadius,tbBorderWidth,tbFgColor,tbApply,tbAdd",trim_image:"tbDynamic",animated_mask:"tbDynamic,tbApply",glitters:"tbDynamic,tbApply",glittertext:"tbTextInput,tbFont,font_arc,tbSize,tbStrokeWidth,tbRotation,tbDynamic,tbApply",image_in_text:"tbTextInput,tbFont,font_arc,tbFgColor,tbBgColor,tbSize,tbStrokeWidth,tbRotation,tbShadow,tbApply",stars:"",overlay_image:"tbUploadOverlay,tbAdd",overlay_active:"tbBgResize,tbtxtRotate,tbaSlider,tbFgOpacity,tbShadow,tbApply",overlay_active_no_opacity:"tbBgResize,tbtxtRotate,tbaSlider,tbShadow,tbApply",overlay_trans_active:"tbBgResize,tbtxtRotate,tbaSlider,tbOverlayTrans,tbFgOpacity,tbShadow,tbApply",transparency:"tbDynamic",gif_only:"tbDynamic",convert_image_type:"tbConvert,tbApply,tbAdd",add_flag:"tbDynamic,tbApply,tbAdd",lolcats:"tbTextInput,tbFgColor,tbBgColor,tbSize,tbRotation,tbApply,tbAdd",speechbubble:"tbDynamic,tbTextInput,tbFont,tbtxtResize,tbaSlider,tbFgColor,tbApply",rain:"tbDynamic,tbtxtRotate,tbaSlider,tbApply",expand_canvas:"tbDynamic,tbBgTrans,tbApply",animation_generator:"",add_to_animation:"",help_pages:"",upload:""};this._hideTools()},_hideTools:function(){this._removeDynaContent();var a=$(".tb tr");$.each(a,function(b,c){if(c.id){$(c).hide()}});$("#tbAdd").hide()},setEditor:function(c,d){var b=this;b._hideTools();$(".tb #tb_explain").html(d);var a=b.tools[c].split(",");$.each(a,function(e,f){$("#"+f).show();if(f=="tbDynamic"){b._showDynamic(c)}});if(b.current_layer!=null){b.current_layer.postLoadEditor()}},_showTool:function(d,c){var b=this;$("#button_bar .btn").removeClass("focus");d.addClass("focus");b._hideTools();var a=b.tools[c].split(",");$.each(a,function(e,f){$("#"+f).show();if(f=="tbDynamic"){b._showDynamic(c)}})},toolbarBtn:function(d){var b=$(d);var a=b.attr("id");var c=b.attr("class").split(" ")[0]=="fire";if(!c){this._setHeader(b);this._showTool(b,a);this.help=a;this.keepEditor=false}this._performButton(b,c)},_hidePrevious:function(){if(this.action){var old_func_str="this._hide"+this.action+"()";try{eval(old_func_str)}catch(e){}}this._destroyCurrent();this.image_layer.setOriginalSize()},_performButton:function(element,fireOnce){var tool=element.attr("id");if(!fireOnce){this._hidePrevious();this.action=tool}var new_func_str="this._show"+tool+"(element)";try{eval(new_func_str)}catch(e){}},_setHeader:function(a){var c=a.find(".btn_txt");var b=a.find(".explain");$(".tb #tb_title").html(c.html());$(".tb #tb_explain").html(b.html())},setDimensions:function(b,a,d,c){$("#width").val(b);$("#height").val(a);$("#offsetx").val(d);$("#offsety").val(c)},download:function(){var a=this.image_layer.img.attr("src");location.href="./index.cfm?fa=download_file&image_path="+a},upload_to_partner:function(){var b=this.image_layer.img.attr("src");var a=location.href;if(!b.startsWith("https")){b=b.replace("http","https")}var a="https://"+window.location.host+"/index.cfm?fa=upload_to_partner&image_path="+b;location.href=a}});$.Class("Toolbar",{app:null},{init:function(a){this.app=a;this._bindButtons()},_bindButtons:function(){var a=this;$(".fire").click(function(b){a.buttonAction(b)})},buttonAction:function(a){var b=a.currentTarget;this.app.action("tb",b)}});$.Class("iBox",{},{init:function(d,a,b,c){this.parent=d;this.size=b;this.className=c||"";this._createLayers();this.load(a);this._setPosition();return this},loaded:function(){var a=this;this.wrapper.prepend(this.close);$("#ibox .change").change(function(){a._optionChanged($(this))});$("#ibox .action").bind("click",function(b){a._fireAction($(this))});$("#ibox .perform").bind("click",function(b){a._optionChanged($(this))});app._hideLoading()},_optionChanged:function(a){if(a.attr("id")=="close"){this.parent.change(a);return this.destroy()}this.parent.change(a)},_fireAction:function(a){},_setPosition:function(){var a=$("#canvas");var b=a.offset();this.wrapper.offset(b);if(this.size){this.wrapper.width(this.size[0]);this.wrapper.height(this.size[1])}else{}},load:function(b){var a=this;app._showLoading();this.wrapper.load(b,function(){a.loaded(this)})},_createLayers:function(){this.close=$("<div id='close' class='perform'></div>");this.wrapper=$("<div id='ibox' class='wrapper layer overlay "+this.className+"'></div>");$("body").append(this.wrapper)},html:function(a){this.wrapper.html(a);this.loaded()},destroy:function(){this.wrapper.remove()}});$.Class("Layer",{},{init:function(){return this._super()},destroy:function(){},change:function(a){},refresh:function(a){},postLoadEditor:function(){},postRequest:function(){},getData:function(){return{}},_setPosition:function(){this._checkSize()},_checkSize:function(){if(!this.Class.max_size){return}var b=this.Class.max_size[0];var a=this.Class.max_size[1];this.src_image.setMaxSize(b,a)}});Layer("ImageLayer",{img:null,div:null,viewport:null,original_size:null,state:null,frames:0,isTransparent:false},{init:function(a){this.viewport=a;this.img=$("#img");this.div=$("#imgDiv");this.images=[];this.isTransparent=false;this._bindEvents()},_bindEvents:function(){var a=this;this.img.bind("load",function(){a._setimgDiv();if(a.state=="resize"){a._setToolbox()}})},change:function(a){var b=a.attr("id");if(b=="aspect"){this.setAspect(a.is(":checked"))}if(b=="width"||b=="height"){this.manualWidthHeight(b,a.val())}if(b=="offsetx"||b=="offsety"){this.manualPosition(b,a.val())}},cleanup:function(){this.removeClipbox()},setOriginalSize:function(){if(this.original_size){this.img.width(this.original_size.width);this.img.height(this.original_size.height);this.div.css("left",0);this.div.css("top",0);this._setimgDiv()}},setMaxSize:function(d,c){var b=this.img.width();var a=this.img.height();if(b<d&&a<c){return}if(b>a){a=a/(b/d);b=d}else{b=b/(a/c);a=c}this.img.width(Math.floor(b));this.img.height(Math.floor(a));this._setimgDiv();app.notifyUser("resized",d,c)},_setimgDiv:function(){var b=this.img.width();var a=this.img.height();this.div.width(b);this.div.height(a);this._centerElement()},_setToolbox:function(b,a,d,c){var b=b||this.img.width();var a=a||this.img.height();var d=d||0;var c=c||0;this.viewport.app.toolbox.setDimensions(b,a,d,c)},loadImages:function(d){var a=d.images;if(a.length==0){return}this._clearImages();if(a.length>1){this.loadMultiple(a);return}var c=this;var b=new Image();b.onload=function(){c._imageReady(this)};b.src=a[0].url;if(a[0].frames){this.frames=a[0].frames}if(a[0].isTransparent!==undefined){this.isTransparent=a[0].isTransparent}this._setImageInfo(a[0])},_setImageInfo:function(a){$("#infow").html(a.width);$("#infoh").html(a.height);$("#infos").html(a.size);if(a.colors==0){$("#infocolors").hide()}else{$("#infocolors").show()}$("#infoc").html(a.colors)},_clearImages:function(){var a=this;$.each(a.images,function(b,c){c.remove()});a.div.show()},loadMultiple:function(a){var b=this;b.div.hide();$.each(a,function(d,e){var c=new Image();var f=$('<div class="locked multiple"></div><br />');c.onload=function(){b._multipleElement(f)};c.src=e.url;$(c).appendTo(f);f.appendTo($("#canvas"));b.images.push(f);if(e.comments){b._addComment(e,f)}});this.viewport.app._hideLoading()},_addComment:function(b,d){var a=$("<br /><font class='comment fat'>Size: </font><font class='comment'>"+b.size+" bytes</font><font class='comment fat'> Colors: </font><font class='comment'>"+b.colors+"</font>");var c=$("<br /><font class='comment fat'>Reduction: </font><font class='comment fat red'>"+b.comments+"</font>");a.appendTo(d);c.appendTo(d)},_imageReady:function(a){this.img.attr("src",a.src);this.original_size={width:a.width,height:a.height};this.setOriginalSize();this._setimgDiv();this.viewport.app._hideLoading()},_centerElement:function(){var a=this.div.parent();this.div.css({top:Math.round(($(a).height()-this.div.outerHeight(true))/2)})},_multipleElement:function(b){var a=this;var c=b.parent();b.css({left:Math.round(($(c).width()-b.outerWidth(true))/2)});b.bind("mouseup",function(){a.chooseImage(b)})},chooseImage:function(a){var c={url:a.find("img").attr("src")};var b={fa:"choose_image",data:$.toJSON(c)};app.ajax({success:function(d){app.toolbox._catchResult(d)},type:"POST",url:"ajaxindex.cfm",dataType:"json",data:b})},clipBoxChanged:function(b,a,d,c){if(this.state=="resize"){this.img.width(b);this.img.height(a);this._setimgDiv();this.img.syncPosition()}this._setToolbox(b,a,d,c)},resizeSlideImage:function(d,f,a){var a=(a==false);var e=f.value;var c=this.original_size.width;var b=this.original_size.height;this.img.width(c*(e/100));this.img.height(b*(e/100));if(!a){this._setimgDiv();this._setToolbox();this.img.syncPosition()}},addClipbox:function(c,b){var a=this;a.state=c;this.img.cropRes({type:c,image:a,aspect:b,callback:a.clipBoxChanged})},reset:function(){this.removeClipbox()},removeClipbox:function(){this.img.cropRes("hide")},setAspect:function(a){this.img.setAspect(a)},manualPosition:function(b,a){this.img.manualPosition(b,a)},manualWidthHeight:function(b,a){this.img.manualWidthHeight(b,a)},getData:function(){var b=this.img;var a=b.offset();var c={width:b.width(),height:b.height(),left:parseInt(a.left),top:parseInt(a.top)};return c}});Layer("TextLayer",{fg:null,bg:null,fg_opacity:100,bg_color:"FFFFFF",bg_opacity:0,bg_width:0,circle:0,zoom:null,align:"west",blank:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="},{init:function(c,b){var a=this;a.toolbox=c;a.opacity_changed=false;a.text_visible=false;a._resetKerning();a.initValues(b);$(".sp-alpha").show();a._createLayers();a.showText();return a},refresh:function(a){this.initValues(a);this.showText()},initValues:function(b){var a=this;var b=b||{};a.text=$("#text").val();a.font=$("#font").val();a.size=$("#size").val();a.rotation=$("#rotation").val();a.align=$("#align.focus").attr("class").split(" ")[0];a.spacing=$("input[name=line_space]:checked").val();a.kerning=$("input[name=kerning]:checked").val();a.strokewidth=$("#strokewidth").val();a.arc_val=$("#arc_val").val();a.arc_flip=$("#arc_flip").is(":checked");a.shadow_left=4;a.shadow_top=4;a.shadow_blur=$("#shadow_blur").val();a.shadow_fall=$("#shadow_fall").val();$.each(b,function(c,d){if(c=="align"){a._setAlign($("#align."+d))}a[c]=d});a.show_shadow=$("#show_shadow").is(":checked")},showText:function(){this._setColor();this.showBase();this.showOutline();this.showShadow();this.text_visible=true},showBase:function(){this.image.attr("src",this._getUrlString());this.image.css({opacity:this.fg_opacity})},showOutline:function(){if(this.strokewidth>0){this.stroke.show();this.stroke.attr("src",this._getUrlString(true));this.stroke.css({opacity:this.bg_opacity})}else{this.stroke.hide()}},showShadow:function(){if(this.show_shadow==true){this.shadow.show();this.shadow.attr("src",this._getUrlString(false,true));this.shadow.css({opacity:this.shadow_opacity})}else{this.shadow.hide()}},_setMover:function(){var a=this;a.options=$("#txt_shadow");a.options.dialog({width:"auto",height:"auto",modal:false,position:{my:"left bottom",at:"left top",of:$("#tbShadow")},open:function(){a._setTouchPad()}});$("#touch_ball").draggable({containment:"#touchpad",drag:function(b){a.change($(this))},stop:function(b){a.change($(this),"stop")}})},_setTouchPad:function(){var d=$("#touchpad");var a=$("#touch_ball");var c=parseInt((d.width()/2)-a.width()/2+this.shadow_left);var b=parseInt((d.height()/2)-a.height()/2+this.shadow_top);a.css({top:b,left:c});$("#shadow_blur").val(this.shadow_blur)},_setColor:function(){var d=$("#fg_color").spectrum("get");var a=(this.fg_color!=d.toHex(true))?true:false;this.fg_color=d.toHex(true);this.opacity_changed=(this.fg_opacity!=d.alpha)||this.opacity_changed;this.fg_opacity=d.alpha;var c=$("#bg_color").spectrum("get");a=(this.bg_color!=c.toHex(true))?true:false||a;this.bg_color=c.toHex(true);this.opacity_changed=(this.bg_opacity!=c.alpha)||this.opacity_changed;this.bg_opacity=c.alpha;var b=$("#shadow_color").spectrum("get");a=(this.shadow_color!=b.toHex(true))?true:false||a;this.shadow_color=b.toHex(true);this.shadow_opacity=b.alpha;return a},_createLayers:function(){var a=this;a.wrapper=$("<div id='wrapper' class='wrapper layer'></div>");a.shadow=$("<img id='shadow_inner' class='preview_text' src='"+a.Class.blank+"'  >");a.stroke=$("<img id='stroke' class='preview_text' src='"+a.Class.blank+"' >");a.image=$("<img id='image' class='preview_text' src='"+a.Class.blank+"'  >");a.wrapper.append(a.shadow).append(a.stroke).append(a.image);a.wrapper.draggable({cursor:"move"});$("#canvas").append(a.wrapper);a.wrapper.offset($("#canvas").offset());a.shadow.bind("load",function(){a._moveShadow()})},destroy:function(){this.image.remove();this.stroke.remove();this.shadow.remove();this.wrapper.remove();this._closeMover();this._resetColors()},_resetColors:function(){$("#fg_color").spectrum("set",this.fg_color);$("#bg_color").spectrum("set",this.bg_color);$(".sp-alpha").hide()},_setSpacing:function(a){this.spacing=a.val()},_setKerning:function(a){this.kerning=a.val()},_appendSymbol:function(a){var b=$("#workTable #text");b.val(b.val()+a.html());this.text=b.val()},_getShadowPosition:function(){var b=this.shadow_left+parseInt((this.image.width()-this.shadow.width())/2);var a=this.shadow_top+parseInt((this.image.height()-this.shadow.height())/2);return{left:b,top:a}},_setShadowPos:function(b){var c=b.parent();var f=c.offset();var a=b.offset();var e=parseInt((a.left-f.left+3)-(c.width()/2));var d=parseInt((a.top-f.top+3)-(c.height()/2));this.shadow_top=d;this.shadow_left=e;this._moveShadow()},_moveShadow:function(){var a=this._getShadowPosition();this._setShadowPosition(a.top,a.left)},_setShadowPosition:function(b,a){this.shadow.css({top:b,left:a})},change:function(a){var b=a.attr("id");if(b=="touch_ball"){return this._setShadowPos(a)}if(b=="fg_color"||b=="bg_color"||b=="shadow_color"){return this._changeAColor(b)}else{if(b=="sym"){this._appendSymbol(a)}else{if(b=="align"){this._setAlign(a)}else{if(b=="line_space"){this._setSpacing(a)}else{if(b=="kerning"){this._setKerning(a)}else{if(b=="fg_opacity"||b=="bg_opacity"||b=="shadow_opacity"){return this._setOpacity(a)}else{if(b=="arc_flip"){this[b]=a.is(":checked")}else{if(b=="shadow_blur"||b=="shadow_fall"||b=="show_shadow"){return this.shadow_changed(a,b)}else{if(b=="close"){return this._closeMover()}else{this[b]=a.val()}}}}}}}}}if(b=="text"){return}else{if(b=="font"){this._resetKerning()}}this.showText()},getStorageValues:function(b){var a=this;b.shadow_left=a.shadow_left;b.shadow_top=a.shadow_top;b.align=a.align},setStorageValues:function(a){},_resetKerning:function(){$("input:radio[name=kerning][value=0]").prop("checked",true);this.kerning=0},_changeAColor:function(c){var a=this._setColor();var b=this.opacity_changed;this.opacity_changed=false;if(!this.text_visible){this.showText()}if(c=="fg_color"&&a){this.showBase()}else{if(c=="bg_color"&&a){this.showOutline()}}if(c=="shadow_color"||b==true){this.showShadow()}this._setOpacity($("#"+c))},shadow_changed:function(a,c){var b=true;if(c=="shadow_fall"){b=this.shadow_fall_change(a)}else{if(c=="show_shadow"){this[c]=a.is(":checked")}else{this.shadow_blur=a.val()}}if(!this.text_visible){this.showText()}if(b){this.showShadow()}},shadow_fall_change:function(b){var a=this.shadow_fall;this.shadow_fall=b.val();return this.shadow_fall!=a},_closeMover:function(){if(this.options){this.options.dialog("close")}},_setOpacity:function(b){var c=b.attr("id");var a=this;a[c]=b.val();a.image.css({opacity:a.fg_opacity});a.stroke.css({opacity:a.bg_opacity});if(c!="shadow_opacity"){this.opacity_changed=true}a.shadow.css({opacity:a.shadow_opacity})},_setAlign:function(a){this.align=a.attr("class").split(" ")[0];$(".align").removeClass("focus");a.addClass("focus")},_imageReady:function(a){this._super(a);this.stroke.width(a.width);this.stroke.height(a.height)},getRequestUrl:function(){var b=this.getData();var a=this._toURL(b);return a},_getUrlString:function(b,e){var c=encodeURIComponent(this.text);var a=(b)?"&stroke=true":"";var d=(e)?"&shadow=true":"";return"./index.cfm?fa=temp_text_2015&font="+this.font+"&size="+this.size+"&color="+this.fg_color+"&rot="+this.rotation+"&align="+this.align+"&spacing="+this.spacing+"&kerning="+this.kerning+a+d+"&strokewidth="+this.strokewidth+"&bg_color="+this.bg_color+"&shadow_color="+this.shadow_color+"&show_shadow="+this.show_shadow+"&shadow_blur="+this.shadow_blur+"&shadow_fall="+this.shadow_fall+"&bg_opacity="+parseInt(this.bg_opacity*100)+"&fg_opacity="+parseInt(this.fg_opacity*100)+"&arc="+this.arc_val+"&arc_flip="+this.arc_flip+"&text="+c},postRequest:function(){this.image.attr("src",this.Class.blank);this.stroke.attr("src",this.Class.blank);this.shadow.attr("src",this.Class.blank);this._closeMover();this.wrapper.offset($("#canvas").offset());this.text_visible=false},getData:function(){var a=this;var c=a.wrapper.offset();var b={fa:"temp_text",text:encodeURIComponent(a.text),font:a.font,size:a.size,color:a.fg_color,opacity:parseInt(a.fg_opacity*100),stroke_color:a.bg_color,strokewidth:a.strokewidth,bg_opacity:parseInt(a.bg_opacity*100),arc:a.circle,left:c.left,top:c.top,align:a.align,shadow_color:a.shadow_color,shadow_left:a._getShadowPosition().left,shadow_top:a._getShadowPosition().top,shadow_blur:a.shadow_blur,shadow_fall:a.shadow_fall,shadow_opacity:parseInt(a.shadow_opacity*100),show_shadow:a.show_shadow,rotation:a.rotation,arc_flip:a.arc_flip,arc:a.arc_val,spacing:a.spacing,kerning:a.kerning};return b}});Layer("Overlay",{blank:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="},{init:function(a){this.type=a.action;this.toolbox=a;this.src_image=a.image_layer;this.bordertype=$("#bordertype").val();this.borderwidth=$("#borderwidth").val();this.cut_trans=$("#borderwidth").is(":checked");this.value=null;this._setColor();this._createLayers();this.toolbox._initSliders();return this},showLayer:function(){var b=this;var a=new Image();a.onload=function(){b._imageReady(this)};a.src=this._getUrlString()},_imageReady:function(a){this.original_size={width:a.width,height:a.height};this.image.attr("src",a.src);this.resizeFrame($("#bg_slider").slider("value"));this._setPosition()},_setColor:function(){var a=$("#fg_color").spectrum("get");this.fg_color=a.toHex(true);this.fg_opacity=a.alpha},_setPosition:function(){var a=this.src_image.img;var b=a.offset();this.wrapper.offset(b);if(this.type=="passe_partout"){this.image.width(a.width());this.image.height(a.height())}else{if(this.bordertype=="outline"){this.wrapper.offset({left:b.left-this.borderwidth,top:b.top-this.borderwidth})}}},resizeSlideImage:function(b,d,a){var a=(a==false);var c=d.value;this.resizeFrame(c);if(!a){this._centerElement()}},resizeFrame:function(b){var c=this.original_size.width;var a=this.original_size.height;this.image.width(c*(b/100));this.image.height(a*(b/100))},_centerElement:function(){var a=this.wrapper.parent();this.wrapper.css({top:Math.round(($(a).height()-this.wrapper.outerHeight(true))/2),left:Math.round(($(a).width()-this.wrapper.outerWidth(true))/2)})},_createLayers:function(){this.wrapper=$("<div id='overlay' class='wrapper layer overlay'></div>");this.image=$("<img id='image' class='preview_overlay' src='"+this.Class.blank+"'  >");this.wrapper.append(this.image);$("#canvas").append(this.wrapper)},destroy:function(){this.image.remove();this.wrapper.remove();if(this.popup){this.popup.destroy()}},_showSelection:function(){var a=this._getPreviewURL();if(this.popup){this.popup.destroy()}this.popup=new iBox(this,a,[750,460])},_showPage:function(c){var b=c.split("-");this.page=b[0];this.index=b[1];var a=this._getPreviewURL();this.popup.load(a)},change:function(a){var b=a.attr("id");if(b=="fg_color"){this._setColor()}else{if(a.is("img")){this.value=b}else{this[b]=a.val()}}this.showLayer()},getRequestUrl:function(){var b=this.getData();var a=this._toURL(b);return a},_getBorderString:function(){var a=this.toolbox.image_layer.img;return"./index.cfm?fa=preview_border&data="+this.bordertype+"&width="+a.width()+"&height="+a.height()+"&borderwidth="+this.borderwidth+"&color="+this.fg_color},_getUrlString:function(){if(this.type=="set_border"){return this._getBorderString()}},getData:function(){var a=this;var b={fa:a.type,cut_trans:this.cut_trans};return b}});Overlay("Vignette",{},{init:function(a){this._super(a);this.value=null;return this},_setPosition:function(){var a=this.src_image.img;var b=a.offset();this.wrapper.offset(b);this.image.width(a.width());this.image.height(a.height())},change:function(a){var b=a.attr("id");if(b=="fg_color"){this._setColor()}else{if(a.is("img")){this.value=b}}this.showLayer()},_getUrlString:function(){var a=this.toolbox.image_layer.img;return"./index.cfm?fa=preview_mask&cover="+this.value+"&color="+this.fg_color+"&format=png"},getData:function(){var a=this;var c=a.wrapper.offset();var b={fa:a.type,border:a.value};return b}});Overlay("Photoborder",{},{init:function(a){this._super(a);this.page="";this.index=1;this.value=null;this._bindEvents();return this},_bindEvents:function(){},_imageSelected:function(){var a=this;var c=a.src_image.div;var d=a.src_image.img;c.appendTo(a.wrapper);c.css("zIndex",0);var b=a.wrapper.parent();a.wrapper.addClass("frame");a.image.css("zIndex",99);c.removeClass("locked").addClass("free");var e=c.offset();a.drag.width(d.width());a.drag.height(d.height());a.drag.offset(c.offset());a._centerElement();$("#tbApply, #tbFgResize, #tbBgResize").show()},_imageReady:function(a){this._super(a);this._imageSelected()},_setPosition:function(){return},_drag:function(a,b){this.src_image.div.offset(b.offset)},_createLayers:function(){var a=this;a._super();a.image.draggable();a.image.draggable("destroy");a.drag=$("<div class='cbDrag preview_text' ></div>");a.drag.appendTo(a.wrapper);a.drag.css("z-index",99);a.drag.draggable({drag:function(b,c){a._drag(b,c)}})},destroy:function(){this.src_image.div.appendTo("#canvas");this.src_image.div.removeClass("free").addClass("locked");this.drag.remove();this._super();this.src_image.setOriginalSize()},_getPreviewURL:function(){return"./?fa=choices&action=get_preview_frames&page="+this.page+"&current_index="+this.index},change:function(a){var b=a.attr("id");if(b=="close"){return}if(b=="preview_frames"){return this._showSelection()}else{if(a.hasClass("page")){return this._showPage(b)}}this.value=b;if(this.popup){this.popup.destroy()}this.showLayer()},_getUrlString:function(){return"./index.cfm?fa=preview_frame&frame="+this.value},getData:function(){var a=this;var d=a.wrapper.offset();var b=a.src_image.div.position();var c={fa:a.type,border:a.value,frame_width:a.wrapper.width(),frame_height:a.wrapper.height(),img_left:b.left,img_top:b.top};return c}});Overlay("Roundborder",{},{init:function(a){this.radius=$("#radius").val();this._super(a);this.showLayer();this._setPosition();return this},_setPosition:function(){var a=this.src_image.div.offset();this.wrapper.offset({left:(a.left+1),top:(a.top+1)})},_getUrlString:function(){var c=this.toolbox.image_layer.img;var b=c.width();var a=c.height();return"./index.cfm?fa=preview_round_border&data=preview_round_border&width="+b+"&height="+a+"&borderwidth="+this.borderwidth+"&color="+this.fg_color+"&radius="+this.radius}});Photoborder("TrimImage",{},{init:function(a){this._super(a);this.fuzz=$("#fuzz").val();return this},_imageSelected:function(){this._super();$("#tbFuzz").show()},_getPreviewURL:function(){return"./?fa=choices&action=get_preview_trims&page="+this.page+"&current_index="+this.index},change:function(a){var b=a.attr("id");if(b=="preview_frames"){return this._showSelection()}else{if(a.hasClass("page")){return this._showPage(b)}}if(a.is("img")){this.value=b}else{this[b]=a.val()}if(this.popup){this.popup.destroy()}this.showLayer()},_getUrlString:function(){var a=this.toolbox.image_layer.img;return"./index.cfm?fa=preview_trim_frame&frame="+this.value+"&format=png&blur="+this.fuzz}});Vignette("Floaties",{max_size:[500,500]},{init:function(a){this._super(a);this.page="";this.index=1;this._setPosition();return this},_setPosition:function(){this._checkSize();var a=this.src_image.img;var b=a.offset();this.wrapper.offset(b);this.wrapper.width(a.width());this.wrapper.height(a.height())},showLayer:function(){var a=this;this.wrapper.css("background-image","url("+this._getUrlString()+")")},_getPreviewURL:function(){return"./?fa=choices&action=get_preview_floaties&page="+this.page+"&current_index="+this.index},change:function(a){var b=a.attr("id");if(b=="close"){return}if(b=="preview_floaties"){return this._showSelection()}else{if(a.hasClass("page")){return this._showPage(b)}}if(this.popup){this.popup.destroy()}this.value=b;this.url=a.attr("src");this.showLayer()},_getUrlString:function(){return this.url},getData:function(){var a=this;var c=a.wrapper.offset();var b={fa:a.type,border:a.value};return b}});Layer("Catcher",{blank:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="},{init:function(b,c){var a=c||function(){};this.type=b.action;this.toolbox=b;this.func=this._bind(a,b);this.src_image=b.image_layer;this._createLayers();this._setPosition();this._bindActions();this.lastClick={left:0,top:0};this.wrapper.css("cursor","pointer");return this},_bindActions:function(){var a=this;a.wrapper.bind("mousedown",function(b,c){a._clicked(b,c)});this.toolbox.image_layer.img.mouseup(function(){a.disableContext()})},_bind:function(b,c){var d=Array.prototype.slice;var a=d.call(arguments,2);return function(){return b.apply(c,a.concat(d.call(arguments)))}},_clicked:function(a){if(a.which==3){return this._enableContext()}var b=this.wrapper.offset();this.lastClick={left:Math.round(a.pageX-b.left),top:Math.round(a.pageY-b.top)};this.func()},disableContext:function(){var a=this;setTimeout(function(){a.wrapper.show()},200)},_enableContext:function(){var a=this;this.wrapper.hide()},_setPosition:function(){this._super();var a=this.src_image.img;var b=a.offset();this.wrapper.offset(b);this.image.width(a.width());this.image.height(a.height())},_createLayers:function(){this.wrapper=$("<div id='overlay' class='wrapper layer overlay catcher'></div>");this.image=$("<img id='image' class='preview_overlay' src='"+this.Class.blank+"'  >");this.wrapper.append(this.image);$("#canvas").append(this.wrapper)},change:function(a){},getData:function(){var a=this;var b={x:a.lastClick[0],y:a.lastClick[1]};return b},destroy:function(){this.toolbox.image_layer.img.unbind("mouseup");this.image.remove();this.wrapper.remove();if(this.popup){this.popup.destroy()}}});Catcher("Glitter",{max_size:[650,650]},{init:function(a,b){this._super(a,b);this.page="";this.index=1;this.value="glitter_32";return this},_getPreviewURL:function(){return"./?fa=choices&action=get_preview_glitter&page="+this.index},_showSelection:function(){var a=this._getPreviewURL();if(this.popup){this.popup.destroy()}this.popup=new iBox(this,a,["auto","auto"],"iBoxGlitter")},_showPage:function(c){var b=c.split("-");this.page=b[0];this.index=b[1];var a=this._getPreviewURL();this.popup.load(a)},change:function(a){var b=a.attr("id");if(b=="preview_glitters"){return this._showSelection()}else{if(a.hasClass("page")){return this._showPage(b)}}if(this.popup){this.popup.destroy()}$("#preview_glitter").attr("src",a.attr("src"));this.value=b},getData:function(){var a=this;var b={x:a.lastClick.left,y:a.lastClick.top,tile:this.value};return b}});TextLayer("ImageText",{},{init:function(b){var a=this;this.base_image=new Image();this.base_image.onload=function(){a._baseLoaded()};$("#td_shadow_fall").css("visibility","hidden");this.frames=app.toolbox.image_layer.frames;this.setBackground();this._super(b);return this},setBackground:function(){this.fgcolor_save=$("#fg_color").spectrum("get");var a=this.fgcolor_save.toRgb();a.r=255;a.g=255;a.b=255;a.a=(this.frames!=1)?1:0;$("#fg_color").spectrum("set",a)},change:function(b,a){var c=b.attr("id");if(c=="touch_ball"&&a=="stop"){return this.showBase()}return this._super(b)},_createLayers:function(){var a=this;this.wrapper=$("<div id='wrapper' class='wrapper layer cover_txt'></div>");this.image=$("<img id='image' class='preview_text' src='"+this.Class.blank+"'  >");this.stroke=$("<div></div>");this.shadow=$("<div></div>");this.wrapper.append(this.image);this.wrapper.draggable({cursor:"move"});$("#canvas").append(this.wrapper);this.wrapper.offset($("#canvas").offset())},_setOpacity:function(b){this.opacity_changed=true;var c=b.attr("id");var a=this;a[c]=b.val()},_baseLoaded:function(){this.image.attr("src",this.base_image.src)},_changeAColor:function(a){if(this.opacity_changed){this.opacity_changed=false;this.showBase();return}this._super(a)},showBase:function(){this.base_image.src=this._getUrlString()},showOutline:function(){this.showText()},showShadow:function(){this.showText()},showText:function(){this._setColor();this.showBase();this.text_visible=true},_getUrlString:function(b,c){var a=this._super(b,c);return a+"&theme=image_text&shadow_left="+this.shadow_left+"&shadow_top="+this.shadow_top+"&shadow_opacity="+parseInt(this.shadow_opacity*100)},getData:function(){var a=this._super();a.theme="image_text";a.shadow_left=this.shadow_left;a.shadow_top=this.shadow_top;a.trans=this.trans;return a},destroy:function(){this._super();$("#td_shadow_fall").css("visibility","visible");$("#fg_color").spectrum("set",this.fgcolor_save)}});TextLayer("GlitterText",{},{init:function(b){var a=this;this.page="";this.index=1;this.edge_value="glitter_150";this.text_value="glitter_145";this.base_image=new Image();this.base_image.onload=function(){a._baseLoaded()};this.edge_image=new Image();this.edge_image.onload=function(){a._edgeLoaded()};this.show_shadow=false;this.hide_inner=false;this._super(b);return this},showBase:function(){this.base_image.src=this._getUrlString()},showOutline:function(){if(this.strokewidth>0){this.stroke.show();this.stroke.attr("src",this._getUrlString(true))}else{this.stroke.hide()}},showShadow:function(){this.show_shadow==false;this.shadow.hide()},_baseLoaded:function(){this.image.attr("src",this.base_image.src)},_edgeLoaded:function(){this.stroke.attr("src",this.edge_image.src)},_getPreviewURL:function(){return"./?fa=choices&action=get_preview_glitter&page="+this.index},_showSelection:function(){var a=this._getPreviewURL();if(this.popup){this.popup.destroy()}this.popup=new iBox(this,a,["auto","auto"],"iBoxGlitter")},_showPage:function(c){var b=c.split("-");this.page=b[0];this.index=b[1];var a=this._getPreviewURL();this.popup.load(a)},change:function(a){var b=a.attr("id");if(b=="text_glitter"||b=="outline_glitter"){this._showSelection();this.previewer=a;return}else{if(b=="hide_inner"){return this._hideInner(a)}else{if(a.hasClass("page")){return this._showPage(b)}}}if(this.popup){this.popup.destroy();this.previewer.attr("src",a.attr("src"));if(this.previewer.attr("id")=="text_glitter"){this.text_value=b}else{if(this.previewer.attr("id")=="outline_glitter"){this.edge_value=b}}this.popup=false}return this._super(a)},_hideInner:function(a){this.hide_inner=a.is(":checked");if(a.is(":checked")==true){this.image.hide()}else{this.image.show()}},_getUrlString:function(c,d){var a=this._super(c,d);var b=(c)?this.edge_value:this.text_value;return a+"&theme=glitters&tile="+b},getData:function(){var a=this._super();a.text_tile=this.text_value;a.edge_tile=this.edge_value;a.hide_inner=this.hide_inner;a.theme="glitters";return a}});Layer("Stars",{max_size:[500,500]},{init:function(a){this.type=a.action;this.toolbox=a;this.stars=new Array();this.src_image=a.image_layer;this._checkSize();this._createLayers();this._setPosition();this._showStars();return this},_showStars:function(){this.popup=new iBox(this,"./?fa=choices&action=stars",["auto","auto"])},_setPosition:function(){var a=this.src_image.img;var b=a.offset();this.wrapper.offset(b);this.wrapper.width(a.width());this.wrapper.height(a.height())},_checkSize:function(){if(!this.Class.max_size){return}var b=this.Class.max_size[0];var a=this.Class.max_size[0];this.src_image.setMaxSize(b,a)},_createLayers:function(){this.wrapper=$("<div id='overlay' class='wrapper layer overlay'></div>");$("#canvas").append(this.wrapper)},destroy:function(){var a=this.stars;$.each(a,function(b,c){if(c){c.remove()}});this.popup.destroy();this.wrapper.remove()},change:function(a){if(a.attr("id")=="close"){return $("#tbStars").show()}if(a.is("img")){this._addStar(a)}else{if(a.is("select")){this._changeStarColors(a)}else{if(a.attr("id")=="stars"){this._showStars();a.hide()}}}},_addStar:function(c){$("#tb_explain").hide();$("#tbDynamic").show();$("#tbApply").show();if(this.stars.length>9){this.toolbox.app.warning("Maximum amount of stars is 9");return}var b=this.stars.length;if(b==0){b=1}var a=c.attr("src").substring(0,c.attr("src").length-4)+"_static.gif";var d=a.substring(a.length-17,a.length-11);this.stars[b]=$("<div id='"+d+"'class='preview_text'><img src='"+a+"'  ></div>");this.wrapper.append(this.stars[b]);this.stars[b].draggable();this._createInput(b)},_createInput:function(c){var a=this;var b=$('<input style="width:auto;" class="'+c+'" type="radio" name="stars" value="radio"><label>Star '+c+":</label>");var e=$('<select id="prev_'+c+'" class="'+c+'"></select>');var h=$('<select id="delay_'+c+'" class="'+c+'"></select>');e.append($("<option>",{begin:"begin"}).text("begin"));for(var d=1;d<c;d++){var f="star "+d;var g="img_"+d;e.append($("<option>",{value:g}).text(f))}this._createTimer(h);e.focus(function(){a._selectionChanged($(this))});h.focus(function(){a._selectionChanged($(this))});b.bind("click",function(){a._selectionChanged($(this))});$("#DynaContent").append(b).append(e).append(h);$("#DynaContent").show()},_selectionChanged:function(a){var c=a.attr("class");var b=this.stars[c];$("[type=radio]."+c).attr("checked","checked");b.hide();setTimeout(function(){b.show()},500)},_createTimer:function(b){b.append($("<option>",{random:"random"}).text("random"));for(i=0;i<=10;i++){var a=i*10;b.append($("<option>",{val:a}).text(a))}for(i=11;i<=20;i++){var a=i*20-100;b.append($("<option>",{val:a}).text(a))}for(i=21;i<=30;i++){var a=i*50-700;b.append($("<option>",{val:a}).text(a))}b.val(0)},_changeStarColors:function(c){var b=c.val();var d="";if(b==""){d="_"}for(i=1;i<7;i++){var f="#preview_star_"+i;var e="./wizards/images/stars/preview_star"+d+i+b+".gif";var a=$(f);a.attr("src",e)}},getData:function(){var b=this;var a=this.stars;var c=[];$.each(a,function(f,k){if(k){var j=k.attr("id");var l=k.position();var d=Math.round(k.width()/2);var h=Math.round(k.height()/2);var e=$("#delay_"+f).val();var g=$("#prev_"+f).val();c.push({img:j,st:g,del:e,xp:(l.left+d),yp:(l.top+h)})}});return c}});Layer("OverlayImage",{blank:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="},{init:function(b){var a=this;a.type=b.action+"_2013";a.toolbox=b;a.src_image=b.image_layer;a.value=null;$("#fg_opacity").slider("value",100);a.opacity=$("#fg_opacity").slider("value");a.overlay_style=$("#overlay_style").val();a.slider=$("#a_slider");a.slider.slider("option","min",-180);a.slider.slider("option","max",180);a.slider.slider("value",0);a.bg_slider=$("#bg_slider");a.bg_slider.slider("value",100);$("#show_shadow").attr("checked",false);a.rotation=0;a._createLayers();a.shadow_left=4;a.shadow_top=4;a.shadow_blur="medium";a.shadow_color=$("#shadow_color").spectrum("get").toHex(true);$("#td_shadow_fall").css("visibility","hidden");$(".sp-alpha").show();a.bindArrows();return a},bindArrows:function(){var a=this;$(document).keydown(function(b){switch(b.which){case 37:a.move("left",-1);break;case 38:a.move("top",-1);break;case 39:a.move("left",1);break;case 40:a.move("top",1);break;default:return}b.preventDefault()})},move:function(d,c){var b=this;var a=parseInt(b.wrapper.css(d));b.wrapper.css(d,a+c)},showLayer:function(){var b=this;var a=new Image();a.onload=function(){b._imageReady(this)};a.src=this._getUrlString()},postLoadEditor:function(){this.show_shadow=this._shadowActive()},_imageReady:function(a){this.original_size={width:a.width,height:a.height};this.image.attr("src",a.src)},_setPosition:function(){var a=this;var b=a.src_image.img;var c=b.offset();a.wrapper.offset(c);a.image.width(a.original_size.width);a.image.height(a.original_size.height);a.wrapper.width(a.original_size.width);a.wrapper.height(a.original_size.height);a.image.resizable({alsoResize:a.wrapper,aspectRatio:true});a.wrapper.draggable({alsoResize:a.wrapper,aspectRatio:true})},resizeSlideImage:function(b,d,a){var e=b.target.id;if(e=="bg_slider"){return this.resize(b,d,a)}if(e=="a_slider"){return this.rotateOverlay(b,d)}var c=d.value;this.opacity=c;this.wrapper.fadeTo(0,c/100)},rotateOverlay:function(a,c){var b=c.value;this.image.css({WebkitTransform:"rotate("+b+"deg)"});this.image.css({"-moz-transform":"rotate("+b+"deg)"});this.image.css({transform:"rotate("+b+"deg)"});this.shadow.css({WebkitTransform:"rotate("+b+"deg)"});this.shadow.css({"-moz-transform":"rotate("+b+"deg)"});this.shadow.css({transform:"rotate("+b+"deg)"});this.rotation=b},resize:function(a,c){var b=c.value;this.resizeImage(b);this.resizeShadow(b)},resizeImage:function(c){var b=this.original_size.width;var a=this.original_size.height;this.image.width(b*(c/100));this.image.height(a*(c/100))},resizeShadow:function(a){var b=this.org_shadow_width;var c=this.org_shadow_height;this.shadow.width(b*(a/100));this.shadow.height(c*(a/100));this._moveShadow()},getRelShadowSize:function(){return this.bg_slider.slider("value")},_createLayers:function(){var a=this;this.wrapper=$("<div id='overlay' class='wrapper layer'></div>");this.image=$("<img id='image' class='preview_text' src='"+this.Class.blank+"'  >");this.shadow=$("<img id='shadow_inner' class='preview_text' src='"+this.Class.blank+"'  >").load(function(){var b=new Image();b.src=this.src;a.org_shadow_width=b.width;a.org_shadow_height=b.height;a.resizeShadow($("#bg_slider").slider("value"))});this.wrapper.append(this.shadow).append(this.image);this.wrapper.draggable({cursor:"move"});$("#canvas").append(this.wrapper);this.wrapper.offset($("#canvas").offset());this.wrapper.fadeTo(0,this.opacity/100)},_setShadow:function(){var a=$("#shadow_color").spectrum("get");this.shadow_color=a.toHex(true);this.shadow_opacity=a.alpha},_shadowActive:function(){var a=$("#show_shadow");if(a.is(":visible")){return self.show_shadow=a.is(":checked")}},showShadow:function(){if(this.show_shadow==true){this._setShadow();this.shadow.show();this.shadow.attr("src",this._getUrlString(true));this.shadow.css({opacity:this.shadow_opacity})}else{this.shadow.hide()}},destroy:function(){$(document).unbind("keydown");this.image.remove();this.shadow.remove();this.wrapper.remove();$("#td_shadow_fall").css("visibility","visible")},change:function(a){var b=a.attr("id");if(b=="touch_ball"){return this._setShadowPos(a)}if(a.is(":checkbox")){this[b]=a.is(":checked")}else{this[b]=a.val()}if(b=="show_shadow"||b=="shadow_color"||b=="shadow_blur"){return this.showShadow()}this.showLayer()},_setMover:function(){var a=this;a.options=$("#txt_shadow");a.options.dialog({width:"auto",height:"auto",modal:false,position:{my:"left bottom",at:"left top",of:$("#tbShadow")},open:function(){a._setTouchPad()}});$("#touch_ball").draggable({containment:"#touchpad",drag:function(b){a.change($(this))},stop:function(b){a.change($(this),"stop")}})},_setTouchPad:function(){var d=$("#touchpad");var a=$("#touch_ball");var c=parseInt((d.width()/2)-a.width()/2+this.shadow_left);var b=parseInt((d.height()/2)-a.height()/2+this.shadow_top);a.css({top:b,left:c});$("#shadow_blur").val(this.shadow_blur)},_setShadowPos:function(b){var c=b.parent();var f=c.offset();var a=b.offset();var e=parseInt((a.left-f.left+3)-(c.width()/2));var d=parseInt((a.top-f.top+3)-(c.height()/2));this.shadow_top=d;this.shadow_left=e;this._moveShadow()},_moveShadow:function(){var a=this._getShadowPosition();this.shadow.css({top:a.top,left:a.left})},_getShadowPosition:function(){var b=this.shadow_left+parseInt((this.image.width()-this.shadow.width())/2);var a=this.shadow_top+parseInt((this.image.height()-this.shadow.height())/2);return{left:b,top:a}},ajaxUploadReady:function(a){var a=$.evalJSON(a);this.frames=a.frames;this.url=a.overlay_src;this.overlayTrans=a.isTransparent;this.showLayer();this._showTools()},_showTools:function(){if(this.src_image.isTransparent==false&&this.frames==1){this.toolbox.setEditor("overlay_active")}else{if(this.frames!=1){this.toolbox.setEditor("overlay_active_no_opacity")}else{this.toolbox.setEditor("overlay_trans_active")}}this._setShadow()},_getUrlString:function(a){if(a){return"./index.cfm?fa=overlay_shadow&color="+this.shadow_color+"&shadow_blur="+this.shadow_blur+"&url="+this.url}return this.url},getData:function(){var b=this;var g=b.image.offset();var d=b.src_image.div.offset();var c=0;var e=0;if(b.show_shadow){var a=this._getShadowPosition();c=a.top;e=a.left}var f={fa:b.type,left:parseInt(g.left-d.left),top:parseInt(g.top-d.top-1),overWidth:b.image.width(),overHeight:b.image.height(),opacity:b.opacity,overlay_style:b.overlay_style,rotation:b.rotation,shadow_color:b.shadow_color,shadow_left:e,shadow_top:c,shadow_blur:b.shadow_blur,shadow_opacity:parseInt(b.shadow_opacity*100),shadow_resize:b.getRelShadowSize(),show_shadow:b.show_shadow};return f}});Catcher("Transparency",{},{init:function(a,b){this._super(a,b);this.clipBoxInfo={}},postLoadEditor:function(){this.type=null;this.change($("#DynaContent input[name=tp_group]:checked"));this.setClipBox()},destroy:function(){this._super();this.destroyCustom();this.wrapper.remove()},destroyCustom:function(){this._destroyDraw();this.toolbox.image_layer.removeClipbox()},change:function(b){var c=b.val();var d=b.attr("id");var a=this;a.destroyCustom();if(c=="select"){a.wrapper.css("cursor","pointer")}else{if(d=="fuzz_tp"||d=="floodfill_tp"||d=="disposal_tp"){$("#tp_area").prop("checked",true);a.change($("#tp_area"));return}else{if(c=="draw"||d=="draw"){a._initDraw();c="draw";$("#tp_draw").prop("checked",true)}else{if(d=="pen_width"){a._initDraw();c="draw";$("#tp_draw").prop("checked",true);$("#width_preview").css("height",b.val());a.canvas.data("sketch").set("size",b.val())}else{if(c=="box"||(d=="do_box"&&a.type!="box")){a.toolbox.image_layer.addClipbox("crop");if(a.type!="box"){c="box";$("#tp_box").prop("checked",true)}}else{if(d=="do_box"){return a.do_box()}else{return}}}}}}a.type=c},setClipBox:function(){var b=this;if(b.type=="box"){var c=this.clipBoxInfo;if(c.width){b.toolbox.image_layer.removeClipbox();b.toolbox.image_layer.addClipbox("crop");var a=b.toolbox.image_layer;a.manualWidthHeight("width",c.width);a.manualWidthHeight("height",c.height);a.manualPosition("offsetx",c.offsetx);a.manualPosition("offsety",c.offsety);$.each(c,function(d,e){$("#"+d).val(e)})}}},do_box:function(){this.clipBoxInfo=this.getClipBoxInfo();var a={};this.toolbox._apply(a)},_getImage:function(){var a=this.canvas[0].toDataURL("image/png");return a},_initDraw:function(){var b=this;var a=$("#canvas");var c=$("#pen_width").val();b.canvas=$('<canvas id="simple_sketch"  height="'+(a.outerHeight()+'" width="'+a.outerWidth()+'" ></canvas>'));a.append(b.canvas);b.canvas.position({my:"left top",at:"left top",of:"#canvas"});b.canvas.sketch({defaultSize:c,defaultColor:"#ff0000",stopPainting:function(){b.sketchCall("stopped")}});b.canvas.css("cursor","crosshair");b.canvas.css("zindex",10)},_destroyDraw:function(){if(this.canvas){this.canvas.remove();this.canvas=null}},sketchCall:function(a){if(a=="stopped"){this.func()}},postRequest:function(){this.destroy();this._createLayers();this._setPosition();this.toolbox.action="transparency";this._bindActions();this.postLoadEditor()},getClipBoxInfo:function(){return{width:$("#width").val(),height:$("#height").val(),offsetx:$("#offsetx").val(),offsety:$("#offsety").val()}},getData:function(){var a=this;var b={};if(this.type=="select"){return{type:a.type,position:[a.lastClick.left,a.lastClick.top]}}if(this.type=="draw"){return{type:a.type,image:a._getImage()}}if(this.type=="box"){var b=this.getClipBoxInfo();b.type=a.type}return b}});Layer("Flags",{blank:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="},{init:function(a){this.type=a.action;this.toolbox=a;this.src_image=a.image_layer;this.flags={1:null,2:null};return this},destroy:function(){if(this.flags[1]){this.flags[1].remove()}if(this.flags[2]){this.flags[2].remove()}},change:function(b){var c=b.attr("id");var a=c.substr(c.length-1);if(b.attr("type")!="CHECKBOX"){$("#check_"+a).attr("checked",true)}this._setFlag(a)},_setFlag:function(e){var d=$("#check_"+e).is(":checked");if(!d){return}var g=$("#flag_choice_"+e).val();var b=$("#pos_choice_"+e).val();var a=$("#scroll_choice_"+e).val();var f="";if(b=="left"||b=="right"){f=(a=="normal")?"down":"up"}else{f=(a=="normal")?"right":"left"}var c=g+"_"+f;this._showStatic(g,e);this._showFlag(c,b,e)},_showStatic:function(c,b){var a="wizards/images/flags/s/"+c+".gif";$("#current_flag_"+b).attr("src",a)},_showFlag:function(b,a,e){var d=this;var c=new Image();c.onload=function(){d._animate(c,a,e)};c.src="wizards/images/flags/s/"+b+".gif"},_animate:function(e,f,g){var c=e.width;var j=e.height;var a=$('<div class="flag_preview"></div>');var b=$(this.src_image.div);var d=b.offset();var k=d.left;var h=d.top;a.appendTo(b);if(this.flags[g]){this.flags[g].remove()}this.flags[g]=a;a.css("background-image","url("+e.src+")");if(f=="top"||f=="bottom"){a.height(j).width(b.width())}if(f=="left"||f=="right"){a.width(c).height(b.height())}k=(f=="right")?(k+b.width()-c-5):k+1;k=(f=="left")?k+5:k;h=(f=="bottom")?(h+b.height()-j-5):h+1;h=(f=="top")?h+5:h;a.offset({left:k,top:h});a.show()},getData:function(){return{}},postLoadEditor:function(){}});TextLayer("TextThemes",{},{init:function(a,b){this.theme=b;if(b=="lolcats"){this.font="Impact";this.fgcolor_save=$("#fg_color").spectrum("get");$("#fg_color").spectrum("set","ffffff");this.bgcolor_save=$("#bg_color").spectrum("get");$("#bg_color").spectrum("set","000000")}this._super(a);return this},_changeAColor:function(a){this._super(a);if(a=="bg_color"){this.showBase()}},_getUrlString:function(){var a=encodeURIComponent(this.text);return"./index.cfm?fa=temp_text_2015&font="+this.font+"&size="+this.size+"&color="+this.fg_color+"&bg_color="+this.bg_color+"&rot="+this.rotation+"&theme="+this.theme+"&align="+this.align+"&spacing="+this.spacing+"&kerning="+this.kerning+"&text="+a},destroy:function(){$("#fg_color").spectrum("set",this.fgcolor_save);$("#bg_color").spectrum("set",this.bgcolor_save);this._super()},getData:function(){var a=this;var b=this._super();b.fa="create_text";b.theme="lolcats";return b}});(function(h,e,g){var n={beforeShow:b,move:b,change:b,show:b,hide:b,mouseup:b,alphaMove:b,color:false,flat:false,showInput:false,showButtons:true,clickoutFiresChange:false,showInitial:false,showPalette:false,showPaletteOnly:false,showSelectionPalette:true,localStorageKey:false,maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:false,className:"",showAlpha:false,theme:"sp-light",palette:["fff","000"],selectionPalette:[]},d=[],j=!!/msie/i.exec(h.navigator.userAgent),m=(function(){function v(z,y){return !!~(""+z).indexOf(y)}var x=document.createElement("div");var w=x.style;w.cssText="background-color:rgba(0,0,0,.5)";return v(w.backgroundColor,"rgba")||v(w.backgroundColor,"hsla")})(),r=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),q=(function(){var v="";if(j){for(var w=1;w<=6;w++){v+="<div class='sp-"+w+"'></div>"}}return["<div class='sp-container'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<div class='sp-choose'></div>","<div class='sp-cancel'></div>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",v,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","</div>","</div>"].join("")})();function t(B,w,z){var y=[];for(var x=0;x<B.length;x++){var v=tinycolor(B[x]);var C=v.toHsl().l<0.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";C+=(tinycolor.equals(w,B[x]))?" sp-thumb-active":"";var A=m?("background-color:"+v.toRgbString()):"filter:"+v.toFilter();y.push('<span title="'+v.toHexString()+'" data-color="'+v.toRgbString()+'" class="'+C+'"><span class="sp-thumb-inner" style="'+A+';" /></span>')}return"<div class='sp-cf "+z+"'>"+y.join("")+"</div>"}function p(){for(var v=0;v<d.length;v++){if(d[v]){d[v].hide()}}}function o(x,v){var w=e.extend({},n,x);w.callbacks={move:u(w.move,v),change:u(w.change,v),show:u(w.show,v),hide:u(w.hide,v),beforeShow:u(w.beforeShow,v),mouseup:u(w.mouseup,v),alphaMove:u(w.alphaMove,v)};return w}function s(aW,ac){var aV=o(ac,aW),aT=aV.flat,y=aV.showPaletteOnly,F=aV.showPalette||y,aB=aV.showInitial&&!aT,E=aV.showInput,aM=aV.showAlpha,U=aV.showSelectionPalette,v=aV.localStorageKey,ae=aV.theme,Q=aV.callbacks,C=f(Z,10),N=false,aD=0,ab=0,aE=0,ap=0,K=0,ao=0,aO=0,ai=0,W=0,O=0,at=0,aP=1,ad=aV.palette.slice(0),af=e.isArray(ad[0])?ad:[ad],ay=aV.selectionPalette.slice(0),w="sp-dragging";var V=aW.ownerDocument,M=V.body,B=e(aW),aL=B.is(":disabled"),aF=e(q,V).addClass(ae),H=aF.find(".sp-color"),aC=aF.find(".sp-dragger"),L=aF.find(".sp-hue"),aS=aF.find(".sp-slider"),av=aF.find(".sp-alpha-inner"),X=aF.find(".sp-alpha"),aw=aF.find(".sp-alpha-handle"),J=aF.find(".sp-input"),P=aF.find(".sp-palette"),aU=aF.find(".sp-initial"),ah=aF.find(".sp-cancel"),G=aF.find(".sp-choose"),R=B.is("input"),ar=R&&!aT,aJ=(ar)?e(r).addClass(ae):e([]),am=(ar)?aJ:B,I=aJ.find(".sp-preview-inner"),S=aV.color||(R&&B.val()),aG=false,T=aV.preferredFormat,ak=T,D=!aV.showButtons||aV.clickoutFiresChange;G.text(aV.chooseText);ah.text(aV.cancelText);function az(){if(j){aF.find("*:not(input)").attr("unselectable","on")}aF.toggleClass("sp-flat",aT);aF.toggleClass("sp-input-disabled",!E);aF.toggleClass("sp-alpha-enabled",aM);aF.toggleClass("sp-buttons-disabled",!aV.showButtons||aT);aF.toggleClass("sp-palette-disabled",!F);aF.toggleClass("sp-palette-only",y);aF.toggleClass("sp-initial-disabled",!aB);aF.addClass(aV.className);if(ar){B.hide().after(aJ)}if(aT){B.after(aF).hide()}else{e(M).append(aF.hide())}if(v&&h.localStorage){try{ay=h.localStorage[v].split(",")}catch(a0){}}am.bind("click.spectrum touchstart.spectrum",function(a1){if(!aL){an()}a1.stopPropagation();if(!e(a1.target).is("input")){a1.preventDefault()}});if(aL){am.addClass("sp-disabled")}aF.click(l);J.change(aH);J.bind("paste",function(){setTimeout(aH,1)});J.keydown(function(a1){if(a1.keyCode==13){aH()}});ah.bind("click.spectrum",function(a1){a1.stopPropagation();a1.preventDefault();ax("cancel")});G.bind("click.spectrum",function(a1){a1.stopPropagation();a1.preventDefault();if(aq()){ag(true);ax()}});c(X,function(a3,a2,a1){aP=(a3/ao);if(a1.shiftKey){aP=Math.round(aP*10)/10}Q.alphaMove(aI());aA()},A,aX);c(L,function(a2,a1){W=(a1/ap);aA()},A,aX);c(H,function(a2,a1){O=a2/aD;at=(ab-a1)/ab;aA()},A,aX);if(!!S){Y(S);au();ak=T||tinycolor(S).format;aK(S)}else{au()}if(aT){z()}function aZ(a1){if(a1.data&&a1.data.ignore){Y(e(this).data("color"));aA()}else{Y(e(this).data("color"));ag(true);aA();ax()}return false}var aY=j?"mousedown.spectrum":"click.spectrum touchstart.spectrum";P.delegate(".sp-thumb-el",aY,aZ);aU.delegate(".sp-thumb-el::nth-child(1)",aY,{ignore:true},aZ)}function aK(aY){if(U){ay.push(tinycolor(aY).toHexString());if(v&&h.localStorage){h.localStorage[v]=ay.join(",")}}}function aN(){var a4=[];var a3=ay;var a1={};var a2;if(F){for(var a0=0;a0<af.length;a0++){for(var aZ=0;aZ<af[a0].length;aZ++){a2=tinycolor(af[a0][aZ]).toHexString();a1[a2]=true}}for(a0=0;a0<a3.length;a0++){var aY=tinycolor(a3[a0]);a2=aY.toHexString();if(!a1.hasOwnProperty(a2)){a4.push(a3[a0]);a1[a2]=true}}}return a4.reverse().slice(0,aV.maxSelectionSize)}function aQ(){var aY=aI();var aZ=e.map(af,function(a0,a1){return t(a0,aY,"sp-palette-row sp-palette-row-"+a1)});if(ay){aZ.push(t(aN(),aY,"sp-palette-row sp-palette-row-selection"))}P.html(aZ.join(""))}function aj(){if(aB){var aY=aG;var aZ=aI();aU.html(t([aY,aZ],aZ,"sp-palette-row-initial"))}}function A(){if(ab===0||aD===0||ap===0){Z()}aF.addClass(w)}function aX(){aF.removeClass(w);Q.mouseup(aI())}function aH(){var aY=tinycolor(J.val());if(aY.ok){Y(aY)}else{J.addClass("sp-validation-error")}}function an(){if(N){ax()}else{z()}}function z(){if(N){Z();return}if(Q.beforeShow(aI())===false){return}p();N=true;e(V).bind("click.spectrum",ax);e(h).bind("resize.spectrum",C);aJ.addClass("sp-active");aF.show();if(F){aQ()}Z();au();aG=aI();aj();Q.show(aG)}function ax(aZ){if(aZ&&aZ.type=="click"&&aZ.button==2){return}if(!N||aT){return}N=false;e(V).unbind("click.spectrum",ax);e(h).unbind("resize.spectrum",C);aJ.removeClass("sp-active");aF.hide();var aY=!tinycolor.equals(aI(),aG);if(aY){if(D&&aZ!=="cancel"){ag(true)}else{al()}}Q.hide(aI())}function al(){Y(aG,true)}function Y(aY,a0){if(tinycolor.equals(aY,aI())){return}var aZ=tinycolor(aY);var a1=aZ.toHsv();W=a1.h;O=a1.s;at=a1.v;aP=a1.a;au();if(!a0){ak=T||aZ.format}}function aI(){return tinycolor.fromRatio({h:W,s:O,v:at,a:Math.round(aP*100)/100})}function aq(){return !J.hasClass("sp-validation-error")}function aA(){au();Q.move(aI())}function au(){J.removeClass("sp-validation-error");aR();var a0=tinycolor({h:W,s:"1.0",v:"1.0"});H.css("background-color",a0.toHexString());var a4=ak;if(aP<1){if(a4==="hex"||a4==="name"){a4="rgb"}}var a1=aI(),a5=a1.toHexString(),a2=a1.toRgbString();if(m||a1.alpha===1){I.css("background-color",a2)}else{I.css("background-color","transparent");I.css("filter",a1.toFilter())}if(aM){var aZ=a1.toRgb();aZ.a=0;var aY=tinycolor(aZ).toRgbString();var a3="linear-gradient(left, "+aY+", "+a5+")";if(j){av.css("filter",tinycolor(aY).toFilter({gradientType:1},a5))}else{av.css("background","-webkit-"+a3);av.css("background","-moz-"+a3);av.css("background","-ms-"+a3);av.css("background",a3)}}if(E){if(aP<1){if(a4==="hex"||a4==="name"){a4="rgb"}}J.val(a1.toString(a4))}if(F){}aj()}function aR(){var a0=O;var aY=at;var a3=a0*aD;var a1=ab-(aY*ab);a3=Math.max(-aE,Math.min(aD-aE,a3-aE));a1=Math.max(-aE,Math.min(ab-aE,a1-aE));aC.css({top:a1,left:a3});var aZ=aP*ao;aw.css({left:aZ-(aO/2)});var a2=(W)*ap;aS.css({top:a2-ai})}function ag(aZ){var aY=aI();if(R){B.val(aY.toString(ak)).change()}var a0=!tinycolor.equals(aY,aG);aG=aY;aK(aY);if(aZ&&a0){Q.change(aY)}}function Z(){aD=H.width();ab=H.height();aE=aC.height();K=L.width();ap=L.height();ai=aS.height();ao=X.width();aO=aw.width();if(!aT){aF.offset(a(aF,am))}aR()}function x(){B.show();am.unbind("click.spectrum touchstart.spectrum");aF.remove();aJ.remove();d[aa.id]=null}az();var aa={show:z,hide:ax,toggle:an,reflow:Z,set:function(aY){Y(aY);ag()},get:aI,destroy:x,container:aF};aa.id=d.push(aa)-1;return aa}function a(C,D){var B=0;var z=C.outerWidth();var F=C.outerHeight();var v=D.outerHeight();var E=C[0].ownerDocument;var w=E.documentElement;var A=w.clientWidth+e(E).scrollLeft();var x=w.clientHeight+e(E).scrollTop();var y=D.offset();y.top+=v;y.left-=Math.min(y.left,(y.left+z>A&&A>z)?Math.abs(y.left+z-A):0);y.top-=Math.min(y.top,((y.top+F>x&&x>F)?Math.abs(F+v-B):B));return y}function b(){}function l(v){v.stopPropagation()}function u(w,x){var y=Array.prototype.slice;var v=y.call(arguments,2);return function(){return w.apply(x,v.concat(y.call(arguments)))}}function c(A,F,w,x){F=F||function(){};w=w||function(){};x=x||function(){};var G=A.ownerDocument||document;var I=false;var z={};var J=0;var H=0;var C=("ontouchstart" in h);var B={};B.selectstart=E;B.dragstart=E;B[(C?"touchmove":"mousemove")]=y;B[(C?"touchend":"mouseup")]=D;function E(K){if(K.stopPropagation){K.stopPropagation()}if(K.preventDefault){K.preventDefault()}K.returnValue=false}function y(O){if(I){if(j&&document.documentMode<9&&!O.button){return D()}var N=O.originalEvent.touches;var L=N?N[0].pageX:O.pageX;var K=N?N[0].pageY:O.pageY;var P=Math.max(0,Math.min(L-z.left,H));var M=Math.max(0,Math.min(K-z.top,J));if(C){E(O)}F.apply(A,[P,M,O])}}function v(M){var K=(M.which)?(M.which==3):(M.button==2);var L=M.originalEvent.touches;if(!K&&!I){if(w.apply(A,arguments)!==false){I=true;J=e(A).height();H=e(A).width();z=e(A).offset();e(G).bind(B);e(G.body).addClass("sp-dragging");if(!C){y(M)}E(M)}}}function D(){if(I){e(G).unbind(B);e(G.body).removeClass("sp-dragging");x.apply(A,arguments)}I=false}e(A).bind(C?"touchstart":"mousedown",v)}function f(w,y,v){var x;return function(){var A=this,z=arguments;var B=function(){x=null;w.apply(A,z)};if(v){clearTimeout(x)}if(v||!x){x=setTimeout(B,y)}}}var k="spectrum.id";e.fn.spectrum=function(w,v){if(typeof w=="string"){if(w=="get"){return d[this.eq(0).data(k)].get()}else{if(w=="container"){return d[e(this).data(k)].container}}return this.each(function(){var x=d[e(this).data(k)];if(x){if(w=="show"){x.show()}if(w=="hide"){x.hide()}if(w=="toggle"){x.toggle()}if(w=="reflow"){x.reflow()}if(w=="set"){x.set(v)}if(w=="destroy"){x.destroy();e(this).removeData(k)}}})}return this.spectrum("destroy").each(function(){var x=s(this,w);e(this).data(k,x.id)})};e.fn.spectrum.load=true;e.fn.spectrum.loadOpts={};e.fn.spectrum.draggable=c;e.fn.spectrum.defaults=n;e.fn.spectrum.processNativeColorInputs=function(){var w=e("<input type='color' value='!' />")[0];var v=w.type==="color"&&w.value!="!";if(!v){e("input[type=color]").spectrum({preferredFormat:"hex6"})}};(function(B){var M=/^[\s,#]+/,H=/\s+$/,I=0,w=Math,S=w.round,A=w.min,E=w.max,D=w.random,v=B.parseFloat;function Q(aa,ae){if(typeof aa=="object"&&aa.hasOwnProperty("_tc_id")){return aa}var ab=J(aa);var ad=ab.r,ac=ab.g,Y=ab.b,Z=v(ab.a),af=ab.format;return{ok:ab.ok,format:af,_tc_id:I++,alpha:Z,setAlpha:function(ag){currentAlpha=ag},toHsv:function(){var ag=L(ad,ac,Y);return{h:ag.h,s:ag.s,v:ag.v,a:Z}},toHsvString:function(){var ah=L(ad,ac,Y);var aj=S(ah.h*360),ai=S(ah.s*100),ag=S(ah.v*100);return(Z==1)?"hsv("+aj+", "+ai+"%, "+ag+"%)":"hsva("+aj+", "+ai+"%, "+ag+"%, "+Z+")"},toHsl:function(){var ag=T(ad,ac,Y);return{h:ag.h,s:ag.s,l:ag.l,a:Z}},toHslString:function(){var ah=T(ad,ac,Y);var aj=S(ah.h*360),ai=S(ah.s*100),ag=S(ah.l*100);return(Z==1)?"hsl("+aj+", "+ai+"%, "+ag+"%)":"hsla("+aj+", "+ai+"%, "+ag+"%, "+Z+")"},toHex:function(ag){return R(ad,ac,Y,true)},toHexString:function(ag){return"#"+R(ad,ac,Y,true)},toRgb:function(){return{r:S(ad),g:S(ac),b:S(Y),a:Z}},toRgbString:function(){return(Z==1)?"rgb("+S(ad)+", "+S(ac)+", "+S(Y)+")":"rgba("+S(ad)+", "+S(ac)+", "+S(Y)+", "+Z+")"},toName:function(){return X[R(ad,ac,Y)]||false},toFilter:function(al,aj){var ak=R(ad,ac,Y,true);var an=ak;var am=Math.round(v(Z)*255).toString(16);var ah=am;var ag=al&&al.gradientType?"GradientType = 1, ":"";if(aj){var ai=Q(aj);an=ai.toHex();ah=Math.round(v(ai.alpha)*255).toString(16)}return"progid:DXImageTransform.Microsoft.gradient("+ag+"startColorstr=#"+z(am)+ak+",endColorstr=#"+z(ah)+an+")"},toString:function(ah){ah=ah||this.format;var ag=false;if(ah==="rgb"){ag=this.toRgbString()}if(ah==="hex"){ag=this.toHex()}if(ah==="hex6"){ag=this.toHexString(true)}if(ah==="name"){ag=this.toName()}if(ah==="hsl"){ag=this.toHslString()}if(ah==="hsv"){ag=this.toHsvString()}return ag||this.toHexString(true)}}}Q.fromRatio=function(Y){if(typeof Y=="object"){for(var Z in Y){if(Y[Z]===1){Y[Z]="1.0"}}}return Q(Y)};function J(Z){var aa={r:0,g:0,b:0};var Y=1;var ab=false;var ac=false;if(typeof Z=="string"){Z=C(Z)}if(typeof Z=="object"){if(Z.hasOwnProperty("r")&&Z.hasOwnProperty("g")&&Z.hasOwnProperty("b")){aa=F(Z.r,Z.g,Z.b);ab=true;ac="rgb"}else{if(Z.hasOwnProperty("h")&&Z.hasOwnProperty("s")&&Z.hasOwnProperty("v")){aa=P(Z.h,Z.s,Z.v);ab=true;ac="hsv"}else{if(Z.hasOwnProperty("h")&&Z.hasOwnProperty("s")&&Z.hasOwnProperty("l")){aa=G(Z.h,Z.s,Z.l);ab=true;ac="hsl"}}}if(Z.hasOwnProperty("a")){Y=Z.a}}aa.r=A(255,E(aa.r,0));aa.g=A(255,E(aa.g,0));aa.b=A(255,E(aa.b,0));if(aa.r<1){aa.r=S(aa.r)}if(aa.g<1){aa.g=S(aa.g)}if(aa.b<1){aa.b=S(aa.b)}return{ok:ab,format:(Z&&Z.format)||ac,r:aa.r,g:aa.g,b:aa.b,a:Y}}function F(aa,Z,Y){return{r:V(aa,255)*255,g:V(Z,255)*255,b:V(Y,255)*255}}function T(Y,ac,ae){Y=V(Y,255);ac=V(ac,255);ae=V(ae,255);var af=E(Y,ac,ae),aa=A(Y,ac,ae);var ab,ag,Z=(af+aa)/2;if(af==aa){ab=ag=0}else{var ad=af-aa;ag=Z>0.5?ad/(2-af-aa):ad/(af+aa);switch(af){case Y:ab=(ac-ae)/ad+(ac<ae?6:0);break;case ac:ab=(ae-Y)/ad+2;break;case ae:ab=(Y-ac)/ad+4;break}ab/=6}return{h:ab,s:ag,l:Z}}function G(ad,ag,ac){var Y,ae,af;ad=V(ad,360);ag=V(ag,100);ac=V(ac,100);function ab(aj,ai,ah){if(ah<0){ah+=1}if(ah>1){ah-=1}if(ah<1/6){return aj+(ai-aj)*6*ah}if(ah<1/2){return ai}if(ah<2/3){return aj+(ai-aj)*(2/3-ah)*6}return aj}if(ag===0){Y=ae=af=ac}else{var Z=ac<0.5?ac*(1+ag):ac+ag-ac*ag;var aa=2*ac-Z;Y=ab(aa,Z,ad+1/3);ae=ab(aa,Z,ad);af=ab(aa,Z,ad-1/3)}return{r:Y*255,g:ae*255,b:af*255}}function L(Y,ab,ad){Y=V(Y,255);ab=V(ab,255);ad=V(ad,255);var ae=E(Y,ab,ad),Z=A(Y,ab,ad);var aa,ag,af=ae;var ac=ae-Z;ag=ae===0?0:ac/ae;if(ae==Z){aa=0}else{switch(ae){case Y:aa=(ab-ad)/ac+(ab<ad?6:0);break;case ab:aa=(ad-Y)/ac+2;break;case ad:aa=(Y-ab)/ac+4;break}aa/=6}return{h:aa,s:ag,v:af}}function P(ac,aj,ah){ac=V(ac,360)*6;aj=V(aj,100);ah=V(ah,100);var ab=w.floor(ac),ae=ac-ab,aa=ah*(1-aj),Z=ah*(1-ae*aj),ai=ah*(1-(1-ae)*aj),ag=ab%6,Y=[ah,Z,aa,aa,ai,ah][ag],ad=[ai,ah,ah,Z,aa,aa][ag],af=[aa,aa,ai,ah,ah,Z][ag];return{r:Y*255,g:ad*255,b:af*255}}function R(ab,aa,Y,ac){var Z=[z(S(ab).toString(16)),z(S(aa).toString(16)),z(S(Y).toString(16))];if(!ac&&Z[0].charAt(0)==Z[0].charAt(1)&&Z[1].charAt(0)==Z[1].charAt(1)&&Z[2].charAt(0)==Z[2].charAt(1)){return Z[0].charAt(0)+Z[1].charAt(0)+Z[2].charAt(0)}return Z.join("")}Q.equals=function(Z,Y){if(!Z||!Y){return false}return Q(Z).toRgbString()==Q(Y).toRgbString()};Q.random=function(){return Q.fromRatio({r:D(),g:D(),b:D()})};Q.desaturate=function(Z,aa){var Y=Q(Z).toHsl();Y.s-=((aa||10)/100);Y.s=O(Y.s);return Q(Y)};Q.saturate=function(Z,aa){var Y=Q(Z).toHsl();Y.s+=((aa||10)/100);Y.s=O(Y.s);return Q(Y)};Q.greyscale=function(Y){return Q.desaturate(Y,100)};Q.lighten=function(Z,aa){var Y=Q(Z).toHsl();Y.l+=((aa||10)/100);Y.l=O(Y.l);return Q(Y)};Q.darken=function(Z,aa){var Y=Q(Z).toHsl();Y.l-=((aa||10)/100);Y.l=O(Y.l);return Q(Y)};Q.complement=function(Z){var Y=Q(Z).toHsl();Y.h=(Y.h+0.5)%1;return Q(Y)};Q.triad=function(Z){var Y=Q(Z).toHsl();var aa=Y.h*360;return[Q(Z),Q({h:(aa+120)%360,s:Y.s,l:Y.l}),Q({h:(aa+240)%360,s:Y.s,l:Y.l})]};Q.tetrad=function(Z){var Y=Q(Z).toHsl();var aa=Y.h*360;return[Q(Z),Q({h:(aa+90)%360,s:Y.s,l:Y.l}),Q({h:(aa+180)%360,s:Y.s,l:Y.l}),Q({h:(aa+270)%360,s:Y.s,l:Y.l})]};Q.splitcomplement=function(Z){var Y=Q(Z).toHsl();var aa=Y.h*360;return[Q(Z),Q({h:(aa+72)%360,s:Y.s,l:Y.l}),Q({h:(aa+216)%360,s:Y.s,l:Y.l})]};Q.analogous=function(Z,ac,ad){ac=ac||6;ad=ad||30;var Y=Q(Z).toHsl();var ab=360/ad;var aa=[Q(Z)];Y.h*=360;for(Y.h=((Y.h-(ab*ac>>1))+720)%360;--ac;){Y.h=(Y.h+ab)%360;aa.push(Q(Y))}return aa};Q.monochromatic=function(aa,ad){ad=ad||6;var ac=Q(aa).toHsv();var af=ac.h,ae=ac.s,Z=ac.v;var ab=[];var Y=1/ad;while(ad--){ab.push(Q({h:af,s:ae,v:Z}));Z=(Z+Y)%1}return ab};Q.readable=function(ab,Z){var aa=Q(ab).toRgb(),Y=Q(Z).toRgb();return((Y.r-aa.r)*(Y.r-aa.r)+(Y.g-aa.g)*(Y.g-aa.g)+(Y.b-aa.b)*(Y.b-aa.b))>10404};var K=Q.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var X=Q.hexNames=y(K);function y(aa){var Z={};for(var Y in aa){if(aa.hasOwnProperty(Y)){Z[aa[Y]]=Y}}return Z}function V(aa,Y){if(N(aa)){aa="100%"}var Z=W(aa);aa=A(Y,E(0,v(aa)));if(Z){aa=aa*(Y/100)}if(w.abs(aa-Y)<0.000001){return 1}else{if(aa>=1){return(aa%Y)/v(Y)}}return aa}function O(Y){return A(1,E(0,Y))}function U(Y){return parseInt(Y,16)}function N(Y){return typeof Y=="string"&&Y.indexOf(".")!=-1&&v(Y)===1}function W(Y){return typeof Y==="string"&&Y.indexOf("%")!=-1}function z(Y){return Y.length==1?"0"+Y:""+Y}var x=(function(){var ac="[-\\+]?\\d+%?";var ab="[-\\+]?\\d*\\.\\d+%?";var Y="(?:"+ab+")|(?:"+ac+")";var aa="[\\s|\\(]+("+Y+")[,|\\s]+("+Y+")[,|\\s]+("+Y+")\\s*\\)?";var Z="[\\s|\\(]+("+Y+")[,|\\s]+("+Y+")[,|\\s]+("+Y+")[,|\\s]+("+Y+")\\s*\\)?";return{rgb:new RegExp("rgb"+aa),rgba:new RegExp("rgba"+Z),hsl:new RegExp("hsl"+aa),hsla:new RegExp("hsla"+Z),hsv:new RegExp("hsv"+aa),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function C(Z){Z=Z.replace(M,"").replace(H,"").toLowerCase();var Y=false;if(K[Z]){Z=K[Z];Y=true}else{if(Z=="transparent"){return{r:0,g:0,b:0,a:0}}}var aa;if((aa=x.rgb.exec(Z))){return{r:aa[1],g:aa[2],b:aa[3]}}if((aa=x.rgba.exec(Z))){return{r:aa[1],g:aa[2],b:aa[3],a:aa[4]}}if((aa=x.hsl.exec(Z))){return{h:aa[1],s:aa[2],l:aa[3]}}if((aa=x.hsla.exec(Z))){return{h:aa[1],s:aa[2],l:aa[3],a:aa[4]}}if((aa=x.hsv.exec(Z))){return{h:aa[1],s:aa[2],v:aa[3]}}if((aa=x.hex6.exec(Z))){return{r:U(aa[1]),g:U(aa[2]),b:U(aa[3]),format:Y?"name":"hex"}}return false}B.tinycolor=Q})(this);e(function(){if(e.fn.spectrum.load){e.fn.spectrum.processNativeColorInputs()}})})(window,jQuery);var __slice=Array.prototype.slice;(function(a){var b;a.fn.sketch=function(){var c,d,e;d=arguments[0],c=2<=arguments.length?__slice.call(arguments,1):[];if(this.length>1){a.error("Sketch.js can only be called on one element at a time.")}e=this.data("sketch");if(typeof d==="string"&&e){if(e[d]){if(typeof e[d]==="function"){return e[d].apply(e,c)}else{if(c.length===0){return e[d]}else{if(c.length===1){return e[d]=c[0]}}}}else{return a.error("Sketch.js did not recognize the given command.")}}else{if(e){return e}else{this.data("sketch",new b(this.get(0),d));return this}}};b=(function(){function c(d,e){this.el=d;this.canvas=a(d);this.context=d.getContext("2d");this.options=a.extend({toolLinks:true,defaultTool:"marker",defaultColor:"#000000",defaultSize:5,stopPainting:function(){}},e);this.painting=false;this.color=this.options.defaultColor;this.size=this.options.defaultSize;this.tool=this.options.defaultTool;this.readyPaint=this.options.stopPainting;this.actions=[];this.action=[];this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",this.onEvent);if(this.options.toolLinks){a("body").delegate('a[href="#'+(this.canvas.attr("id"))+'"]',"click",function(m){var h,l,g,n,k,f,j;l=a(this);h=a(l.attr("href"));n=h.data("sketch");j=["color","size","tool"];for(k=0,f=j.length;k<f;k++){g=j[k];if(l.attr("data-"+g)){n.set(g,a(this).attr("data-"+g))}}if(a(this).attr("data-download")){n.download(a(this).attr("data-download"))}return false})}}c.prototype.download=function(e){var d;e||(e="png");if(e==="jpg"){e="jpeg"}d="image/"+e;return window.open(this.el.toDataURL(d))};c.prototype.set=function(d,e){this[d]=e;return this.canvas.trigger("sketch.change"+d,e)};c.prototype.startPainting=function(){this.painting=true;return this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),events:[]}};c.prototype.stopPainting=function(){if(this.action){this.actions.push(this.action)}if(this.painting){this.readyPaint()}this.painting=false;this.action=null;return this.redraw()};c.prototype.onEvent=function(d){if(d.which==3){return false}if(d.originalEvent&&d.originalEvent.targetTouches){d.pageX=d.originalEvent.targetTouches[0].pageX;d.pageY=d.originalEvent.targetTouches[0].pageY}a.sketch.tools[a(this).data("sketch").tool].onEvent.call(a(this).data("sketch"),d);d.preventDefault();return false};c.prototype.redraw=function(){var d;this.el.width=this.canvas.width();this.context=this.el.getContext("2d");d=this;a.each(this.actions,function(){if(this.tool){return a.sketch.tools[this.tool].draw.call(d,this)}});if(this.painting&&this.action){return a.sketch.tools[this.action.tool].draw.call(d,this.action)}};return c})();a.sketch={tools:{}};a.sketch.tools.marker={onEvent:function(c){switch(c.type){case"mousedown":case"touchstart":this.startPainting();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopPainting()}if(this.painting){this.action.events.push({x:c.pageX-this.canvas.offset().left,y:c.pageY-this.canvas.offset().top,event:c.type});return this.redraw()}},draw:function(h){var e,d,g,c,f;this.context.lineJoin="round";this.context.lineCap="round";this.context.beginPath();this.context.moveTo(h.events[0].x,h.events[0].y);f=h.events;for(g=0,c=f.length;g<c;g++){e=f[g];this.context.lineTo(e.x,e.y);d=e}this.context.strokeStyle=h.color;this.context.lineWidth=h.size;return this.context.stroke()}};return a.sketch.tools.eraser={onEvent:function(c){return a.sketch.tools.marker.onEvent.call(this,c)},draw:function(d){var c;c=this.context.globalCompositeOperation;this.context.globalCompositeOperation="copy";d.color="rgba(0,0,0,0)";a.sketch.tools.marker.draw.call(this,d);return this.context.globalCompositeOperation=c}}})(jQuery);(function(b,a,c){b.fn.cropRes=function(o){var k="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";var h=b(this);var t=("ontouchstart" in a);var j=!!/msie/i.exec(a.navigator.userAgent);var m={image:null,type:"crop",aspect:false,callback:function(){}};var w={hide:function(){b("#clipBox").remove()}};function r(){var B=["nw","n","ne","w","center","e","sw","s","se"];var A=b("<div id='clipBox'>").appendTo(b("body"));b.each(B,function(D,E){var C=b("<img class='selectTrans' src='"+k+"' >");var F=b("<div class='"+E+" cbDrag' ></div>");A.append(F)});f();return A}function y(A){var B=h.offset();A.offset({top:B.top-1,left:B.left-1});A.width(h.width());A.height(h.height())}function e(C){var D=h.offset();var B=h.width();var A=h.height();C.width(Math.round(B/2));C.height(Math.round(A/2));C.offset({top:Math.round(D.top+(A/4)),left:Math.round(D.left+(B/4))})}function u(D){if(!h.options.aspect){return}var B=D.boxWidth;var A=D.boxHeight;var C=B/A;if(D.direction=="w"||D.direction=="e"){D.height(Math.round(D.width()/C))}else{D.width(Math.round(D.height()*C))}}function n(B,A){var J=A.direction;var H=B.originalEvent.touches;var F=H?H[0].pageX:B.pageX;var D=H?H[0].pageY:B.pageY;var E=D-A.yAtClick;var G=F-A.xAtClick;if(J=="n"||J=="nw"||J=="ne"){var C=A.yPicStart+E;A.offset({top:C});A.height((A.boxHeight-(E*2)))}else{if(J=="s"||J=="sw"||J=="se"){var C=A.yPicStart-E;A.offset({top:C});A.height((A.boxHeight+(E*2)))}}if(J=="nw"||J=="w"||J=="sw"){var I=A.xPicStart+G;A.offset({left:I});A.width((A.boxWidth-(G*2)))}else{if(J=="ne"||J=="e"||J=="se"){var I=A.xPicStart-G;A.offset({left:I});A.width((A.boxWidth+(G*2)))}}}function s(O,L){var R=L.direction;var K=O.originalEvent.touches;var B=K?K[0].pageX:O.pageX;var A=K?K[0].pageY:O.pageY;var D=A-L.yAtClick;var E=B-L.xAtClick;var J=h.offset();var Q=L.offset();var P=h.width()-(Q.left-J.left);var N=h.height()-(Q.top-J.top);if(R=="n"||R=="nw"||R=="ne"){var S=L.yPicStart+D;var T=L.boxHeight-(D);if(S<=J.top-1){S=J.top-1;T=L.yPicStart-J.top+L.boxHeight+1}if(T>=1){L.height(T);L.offset({top:S})}}else{if(R=="s"||R=="sw"||R=="se"){var T=L.boxHeight+D;if(N>T){L.height(T)}else{L.height(N-1)}}}if(R=="nw"||R=="w"||R=="sw"){var G=L.xPicStart+E;var I=L.boxWidth-(E);if(G<=J.left-1){G=J.left-1;I=L.xPicStart-J.left+L.boxWidth+1}if(I>=1){L.width(I);L.offset({left:G})}}else{if(R=="ne"||R=="e"||R=="se"){var I=L.boxWidth+(E);if(P>I){L.width(I)}else{L.width(P-1)}}}if(R=="center"){var F=parseInt(L.xPicStart+E);var M=parseInt(L.yPicStart+D);var C=parseInt(J.left+h.width()-L.boxWidth-1);var H=parseInt(J.top+h.height()-L.boxHeight-1);if(F>C){F=C}if(M>H){M=H}if(M<J.top){M=J.top-1}if(F<J.left){F=J.left-1}L.offset({left:F,top:M})}}function g(C){var B=Math.round(C.width());var A=Math.round(C.height());var E=C.offset();var D=h.offset();h.options.callback.apply(h.options.image,[B,A,Math.floor(E.left-D.left+1),Math.floor(E.top-D.top+1)])}function q(){}function d(A){var D=b(A.currentTarget);var C=h.clipBox;C.direction=D.attr("class").split(" ")[0];var E=C.offset();C.xPicStart=E.left;C.yPicStart=E.top;var B=A.originalEvent.touches;C.xAtClick=B?B[0].pageX:A.pageX;C.yAtClick=B?B[0].pageY:A.pageY;C.boxHeight=b("#clipBox").height();C.boxWidth=b("#clipBox").width()}function v(A){d(A);b("div").disableSelection()}function x(){b("div").enableSelection()}function z(D,C,B){var A=h.clipBox;s(B,A);g(A)}function l(D,C,B){var A=h.clipBox;n(B,A);u(A);g(A)}function f(){if(h.options.type=="resize"){b.fn.spectrum.draggable(b(".cbDrag"),l,v,x)}if(h.options.type=="crop"){b.fn.spectrum.draggable(b(".cbDrag"),z,v,x)}}function p(){var A=h.clipBox;var G=h.width();var H=h.height();var E=h.offset();var B=A.offset();if(A.width()>G){A.width(G)}if(A.height()>H){A.height(H)}var C=E.top+H-A.height()-1;var F=(C<B.top)?C:B.top;var D=E.left+G-A.width()-1;var I=(D<B.left)?D:B.left;A.offset({left:I,top:F})}this.setAspect=function(A){h.options.aspect=A};this.manualWidthHeight=function(C,B){var A=h.clipBox;if(C=="width"){A.width(B);A.direction="w"}else{A.height(B);A.direction="n"}if(h.options.aspect){u(A)}if(h.options.type=="crop"){p()}g(A)};this.manualPosition=function(D,C){var B=h.clipBox;var A=h.offset();var C=Math.abs(C);if(D=="offsetx"){B.offset({left:(C+A.left-1)})}else{B.offset({top:(C+A.top-1)})}p();g(B)};this.syncPosition=function(){if(h.options.type=="resize"){y(h.clipBox)}};if(b.type(o)=="string"){return w[o].apply()}h.options=b.extend(m,o||{});return this.each(function(){if(!b("#clipBox").get(0)){h.clipBox=r()}else{h.clipBox=b("#clipBox")}h.clipBox.show();if(h.options.type=="resize"){y(h.clipBox)}if(h.options.type=="crop"){e(h.clipBox)}h.clipBox.boxWidth=h.clipBox.width();h.clipBox.boxHeight=h.clipBox.height();g(h.clipBox)})}})(jQuery,window);(function(a){a.fn.disableSelection=function(){return this.attr("unselectable","on").css("user-select","none").on("selectstart",function(){return false})}})(jQuery);(function(a){a.fn.enableSelection=function(){return this.removeAttr("unselectable").css("user-select","auto").on("selectstart",function(){return true})}})(jQuery);$.Class("Facebook",{},{init:function(a){this.app=a;this._initJavascript();this.current_request=null},_initJavascript:function(){},login:function(c,b){var a=this;FB.login(function(d){if(d.authResponse){a.show(c,b)}else{}},{scope:"user_photos,email,friends_photos"})},_waiting:function(){$.colorbox({inline:true,href:"#fb_popup",width:"300px",height:"300px",onComplete:function(){$("#cboxLoadingOverlay, #cboxLoadingGraphic").show()}})},show:function(e,c){var d={data:$.toJSON(c)}||{};var b="";this._waiting();var a=this;if(e=="upload"){b="./?fa=show_facebook_upload&action=save_to"}else{if(e=="get_album_photos"){b="./ajaxindex.cfm?fa=facebook&action="+e+"&rand="+Math.random()}else{if(e=="show_upload"){$("#fb_popup").load("./?fa=facebook",function(){$.colorbox({inline:true,href:"#fb_popup",onClosed:function(){a._hideColorBox()}})});a._resizeColorBox();return}else{if(e=="your_fonts"){b="./ajaxindex.cfm?fa=facebook&action="+e+"&rand="+Math.random()}}}}var a=this;$.ajax({success:function(f){a._catchResult(f,e)},type:"POST",url:b,dataType:"json",data:d});return},showAlbumPhotos:function(){var c=this;c._waiting();c.popup=$("#fb_popup");c.popup.html("");var a=$('<select id="fb_album_select" class="perform"></select>');$.each(c.albums,function(d,f){var e=$('<option value="'+d+'">'+f+"</option>");if(d==c.album_selected){e.attr("selected",true)}e.appendTo(a)});a.appendTo(c.popup);var b=$('<div id="photos"></div>');b.appendTo(c.popup);$.each(c.photos,function(e,f){var d=$('<img class="action fb_pic" id="'+e+'" src="'+f.p+'" />');d.load(function(){c._resizeColorBox()});d.appendTo(b)});$.colorbox({inline:true,href:"#fb_popup",width:"800px",onComplete:function(){c._resizeColorBox()},onClosed:function(){c._hideColorBox()}});c.initActions()},_resizeColorBox:function(){$("#cboxLoadingOverlay, #cboxLoadingGraphic").hide();$.colorbox.resize()},initActions:function(){var a=this;$("#fb_popup").find(".action").click(function(b){a._imageSelected(b)});$("#fb_popup").find(".perform").change(function(b){a._optionChanged(b)})},_optionChanged:function(c){var b=$(c.currentTarget);var a=b.val();this.album_selected=a;this.show("get_album_photos",{album_id:a})},_imageSelected:function(d){this._waiting();var b=$(d.currentTarget);var a=this.photos[b.attr("id")]["s"];var c=document.DeskTopForm;c.FiletoDownload.value=a;c.submit()},fillAlbumPhotos:function(a){if(a.albums){this.albums=a.albums}if(a.album_selected){this.album_selected=a.album_selected}if(a.photos){this.photos=a.photos}this.showAlbumPhotos()},_catchResult:function(c,b){var a=this;if(b=="get_album_photos"){this.fillAlbumPhotos(c)}if(b=="uploaded_image"){$("#fb_popup").html(c.html);$.colorbox({inline:true,href:"#fb_popup",onComplete:function(){a._resizeColorBox()},onClosed:function(){a._hideColorBox()}})}if(b=="your_fonts"){$.colorbox.close()}if(this.app){this.app.loggedin(b)}return},_hideColorBox:function(){$("#fb_popup").html("")},uploadImage:function(){var a=this;data={title:$("#fb_title").val(),album:$("#fb_album").val()};var b={fa:"ajaxResponse",ajax_fa:"do_facebook_upload",data:$.toJSON(data)};this._waiting();$.ajax({success:function(c){a._catchResult(c,"uploaded_image")},type:"POST",url:"index.cfm",dataType:"json",data:b})},destroy:function(){if(this.popup){this.popup.destroy()}this.popup=null}});$.Class("GooglePlus",{},{init:function(a){this.app=a;this.current_request=null},login:function(b,a){this.window=window.open("/index.cfm?fa=googleplus&action="+b+"&login=true",null,"height=600,width=600,status=yes,toolbar=no,location=no")},loggedIn:function(a,b){this.window.close();if(this.app){if(this.app.loggedin(b)){return}}this.show(b)},_waiting:function(){$.colorbox({inline:true,href:"#fb_popup",width:"300px",height:"300px",onComplete:function(){$("#cboxLoadingOverlay, #cboxLoadingGraphic").show()}})},show:function(e,c){var d={data:$.toJSON(c)}||{};var b="";this._waiting();var a=this;if(e=="upload"){b="./?fa=show_facebook_upload&action=save_to"}else{if(e=="get_album_photos"){b="./ajaxindex.cfm?fa=googleplus&action="+e+"&rand="+Math.random()}else{if(e=="show_upload"){$("#fb_popup").load("./?fa=googleplus&action=show_upload",function(){$.colorbox({inline:true,href:"#fb_popup",onClosed:function(){a._hideColorBox()}})});a._resizeColorBox();return}}}var a=this;$.ajax({success:function(f){a._catchResult(f,e)},type:"POST",url:b,dataType:"json",data:d});return},showAlbumPhotos:function(){var c=this;c._waiting();c.popup=$("#fb_popup");c.popup.html("");var a=$('<select id="fb_album_select" class="perform"></select>');$.each(c.albums,function(d,f){var e=$('<option value="'+d+'">'+f+"</option>");if(d==c.album_selected){e.attr("selected",true)}e.appendTo(a)});a.appendTo(c.popup);var b=$('<div id="photos"></div>');b.appendTo(c.popup);$.each(c.photos,function(e,f){var d=$('<img class="action fb_pic" id="'+e+'" src="'+f.p+'" />');d.load(function(){c._resizeColorBox()});d.appendTo(b)});$.colorbox({inline:true,href:"#fb_popup",width:"800px",onComplete:function(){c._resizeColorBox()},onClosed:function(){c._hideColorBox()}});c.initActions()},_resizeColorBox:function(){$("#cboxLoadingOverlay, #cboxLoadingGraphic").hide();$.colorbox.resize()},initActions:function(){var a=this;$("#fb_popup").find(".action").click(function(b){a._imageSelected(b)});$("#fb_popup").find(".perform").change(function(b){a._optionChanged(b)})},_optionChanged:function(c){var b=$(c.currentTarget);var a=b.val();this.album_selected=a;this.show("get_album_photos",{album_id:a})},_imageSelected:function(d){this._waiting();var b=$(d.currentTarget);var a=this.photos[b.attr("id")]["s"];var c=document.DeskTopForm;c.FiletoDownload.value=a;c.submit()},fillAlbumPhotos:function(a){if(a.albums){this.albums=a.albums}if(a.album_selected){this.album_selected=a.album_selected}if(a.photos){this.photos=a.photos}this.showAlbumPhotos()},_catchResult:function(c,b){var a=this;if(b=="get_album_photos"){this.fillAlbumPhotos(c)}if(b=="uploaded_image"){$("#fb_popup").html(c.html);$.colorbox({inline:true,href:"#fb_popup",onComplete:function(){a._resizeColorBox()},onClosed:function(){a._hideColorBox()}})}return},_hideColorBox:function(){$("#fb_popup").html("")},uploadImage:function(){var a=this;data={title:$("#fb_title").val(),album:$("#fb_album").val()};var b={fa:"ajaxResponse",ajax_fa:"do_googpleplus_upload",data:$.toJSON(data)};this._waiting();$.ajax({success:function(c){a._catchResult(c,"uploaded_image")},type:"POST",url:"index.cfm",dataType:"json",data:b})},destroy:function(){if(this.popup){this.popup.destroy()}this.popup=null}});$.Class("CanvasCreation",{go:function(){var c=document.ActionForm;var g=$("#color").val();var e=$("#color2").val();var f=$("#filltype").val();var b=$("#width_cvs").val();var a=$("#height_cvs").val();if(b<5||a<5){alert("Width and height should be at least 5x5 !");return false}if(b>1200||a>1200){alert("Maximum width and hight is 1200x1200 !");return false}var d="width="+b+"&height="+a+"&color="+g+"&color2="+e+"&fill="+f;c.data.value=d;c.fa.value="create_canvas";c.submit()},changedFillType:function(){var a=$("#filltype").val();$("#color_1").show();if(a=="full"){$("#color_2").hide()}else{if(a=="none"){$("#color_2").hide();$("#color_1").hide()}else{$("#color_2").show()}}}},{});TextLayer("SpeechBubble",{},{init:function(b){var a=this;this.page="flat";this.index=1;this.bubble_id="bubble_1";this.fgcolor_save=$("#fg_color").spectrum("get");$("#font").val("Comic-Sans");this.text_width;this.initial=true;this.flipH=false;this.flipV=false;this.slider=$("#a_slider");this.slider.slider("option","min",30);this.slider.slider("option","max",300);this.start_value=this.slider.slider("value");$("#fg_color").spectrum("set","000000");this.temp={};this._super(b,{show_shadow:false,size:30,align:"center",spacing:1.2,font:"Comic-Sans"});return this},_createLayers:function(){var a=this;a._super();a.wrapper.draggable("destroy");a.bubble_img=$("<img id='bubble_img' class='preview_text' src='"+this.Class.blank+"'>");a.bubble=$("<div style='display:inline-block;'></div>");a.bubble.append(a.bubble_img);a.bubble.draggable({cursor:"move"});a.wrapper.prepend(a.bubble);$("#bubble_img").resizable({handles:"s, se, e",start:function(){a.startResize()},resize:function(b,c){a.resizing(b,c)},stop:function(){a._textResized()}});a.bubble.append(a.image);a.image.addClass("hover");a.image.draggable({cursor:"move"})},showBubble:function(){this.bubble_img.attr("src","./wizards/images/speechbubbles/"+this.bubble_id+".png");if(this.initial){this.setInitial()}},setInitial:function(){this.bubble_img.width(300);this.bubble_img.height(175);this.bubble_img.parent().width(300);this.bubble_img.parent().height(175);var b=parseInt((300-this.image.width())/2);var a=parseInt((175-this.image.height())/3);this.image.css({top:a,left:b});this.initial=false},startResize:function(){this.temp.text_pos=this.image.position();this.temp.slider=this.slider.slider("value")},resizing:function(d,k){var e=k.originalSize.width;var g=k.originalSize.height;var j=e/g;var c=k.size;var m=c.width/c.height;var l=c.width/e;var h=c.height/g;var b=parseInt((this.temp.text_pos.left)*l);var o=parseInt((this.temp.text_pos.top)*l);if(m>j){l=h}var f=parseInt((this.text_img.width)*l);var a=parseInt((this.text_img.height)*l);this.image.css({top:o,left:b,width:f,height:a});var n=parseInt(this.temp.slider*l);this.slider.slider("value",n)},change:function(a){var b=a.attr("id");this.wrapper.show();if(b=="bubble"){return this._showSelection()}else{if(a.hasClass("page")){return this._showPage(b)}else{if(a.hasClass("bubble")){return this._bubbleSelected(a)}else{if(b=="mirror"){return this.flip(a)}}}}return this._super(a)},_bubbleSelected:function(a){this.popup.destroy();this._setBubble(a);this.showBubble()},_showPage:function(c){var b=c.split("-");this.page=b[0];this.index=b[1];var a=this._getPreviewURL();this.popup.load(a)},_showSelection:function(){var a=this._getPreviewURL();if(this.popup){this.popup.destroy()}this.popup=new iBox(this,a,[800,450])},_getPreviewURL:function(){return"./?fa=choices&action=get_preview_speechbubbles&page="+this.page+"&current_index="+this.index},flip:function(a){var b=a.attr("class").split(" ")[0];this[b]=!this[b];if(this[b]){this.bubble_img.addClass(b)}else{this.bubble_img.removeClass(b)}},showBase:function(b){var a=this;a.wrapper.show();a.text_img=new Image();a.text.src=this.Class.blank;$(a.text_img).load(function(){a.showBubbleText(b)});$(a.text_img).attr("src",a._getUrlString(b))},showBubbleText:function(b){this.image.attr("src",this.text_img.src);var c=this.start_value/100;var a=this.text_img.height*c;var d=this.text_img.width*c;a=this.text_img.height;d=this.text_img.width;this.image.height(a);this.image.width(d);this.showBubble()},_setBubble:function(a){this.bubble_id=a.attr("id");$("#bubble").attr("src",a.attr("src"))},_textResized:function(){this.start_value=this.slider.slider("value");this.showBase(true)},_getUrlString:function(a){return this._getTextString(a)},_getTextString:function(a){var c=encodeURIComponent(this.text);var b=(a)?this.image.width():0;return"./index.cfm?fa=temp_text_2015&font="+this.font+"&size="+this.size+"&color="+this.fg_color+"&bg_color="+this.bg_color+"&rot="+this.rotation+"&theme=size&align="+this.align+"&spacing="+this.spacing+"&kerning="+this.kerning+"&txt_width="+b+"&txt_percentage="+this.slider.slider("value")+"&text="+c},resizeSlideImage:function(c,e){if(c.type=="slidestop"){return this._textResized()}var d=e.value;var b=this.text_img.width;var a=this.text_img.height;this.image.width(b*(d/this.start_value));this.image.height(a*(d/this.start_value))},getData:function(){var a=this;var d=this._super();var b=this.image.offset();var c=this.bubble_img.offset();d.bubble=a.bubble_id;d.bubble_width=a.bubble_img.width();d.bubble_height=a.bubble_img.height();d.left=c.left;d.top=c.top;d.txt_width=a.image.width();d.txt_height=a.image.height();d.txt_left=b.left;d.txt_top=b.top;d.flipH=this.flipH;d.flipV=this.flipV;d.txt_percentage=this.slider.slider("value");return d},postRequest:function(){this.bubble.offset($("#canvas").offset());this.wrapper.hide()},destroy:function(){$("#fg_color").spectrum("set",this.fgcolor_save);this.bubble_img.remove();this.bubble.remove();this._super()}});Layer("RainEffect",{blank:"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",max_size:[600,600]},{init:function(a){this.toolbox=a;this.src_image=a.image_layer;this.src_img=a.image_layer.img;this.srcSize={width:this.src_img.width(),height:this.src_img.height()};this.slider=$("#a_slider");this.slider.slider("option","min",-80);this.slider.slider("option","max",80);this.slider.slider("value",0);this._checkSize();this.rotation=0;this.timeout=100;this.width=850;this.height=this.width*3;this.step=0;this._createLayers();return this},deg2rad:function(a){return a*(Math.PI/180)},_createLayers:function(){var a=this;this.wrapper=$("<div id='overlay' class='wrapper layer overlay'></div>");this.image=$("<img id='image' class='flag_preview' style='border:1px solid red' src='"+this.Class.blank+"' >");$("#canvas").append(this.wrapper);var b=this.src_img;var c=b.offset();this.wrapper.offset(c);this.wrapper.width(b.width());this.wrapper.height(b.height());this.wrapper.append(this.image)},_animateRain:function(){var b=this.image;var a=this;setTimeout(function(){if(a.timeout==0){return}a.positionRain();a._animateRain()},a.timeout)},change:function(a){var b=a.attr("id");if(a.hasClass("rain_sample")){return this._setValue(b)}if(a.hasClass("ui-icon")){return this._showExample(b)}this[b]=a.val();this.showBase()},_setValue:function(a){var b=a.split("_");$("#rain_"+b[0]).val(b[1]);this.exmpl.hide();this.change($("#rain_"+b[0]))},_showExample:function(b){var a=this;if(!this.exmpl){this.exmpl=$('<div id="exmpl" class="preview_rain"></div>');$("body").append(this.exmpl)}this.exmpl.load("./editors/rain_examples_"+b+".html",function(){a.toolbox._bindActions("#exmpl")});this.exmpl.show().position({my:"left top",at:"right top",of:$("#"+b)})},resizeSlideImage:function(b,c,a){var d=b.target.id;if(d=="a_slider"){return this.rotateOverlay(b,c)}},rotateOverlay:function(a,c){var b=c.value;$("#image").css({WebkitTransform:"rotate("+b+"deg)"});$("#image").css({"-moz-transform":"rotate("+b+"deg)"});this.rotation=b},setInitialPosition:function(){var b=(this.width-this.srcSize.width)/-2;var a=((this.width-this.srcSize.height)/-2)-this.width;this.image.css("top",a).css("left",b)},positionRain:function(){var b=this.rotation;var c=850*this.step*Math.sin(this.deg2rad(b))+"px";var a=850*this.step*-1*Math.cos(this.deg2rad(b))+"px";$("#image").css({WebkitTransform:"translate("+c+","+a+") rotate("+b+"deg)"});$("#image").css({"-moz-transform":"translate("+c+","+a+") rotate("+b+"deg)"});if(this.step==1){this.step=-1}else{this.step+=1}},showBase:function(){this.image.attr("src",this._getUrlString())},_getUrlString:function(){return"./index.cfm?fa=preview_rain&intensity="+this.rain_intens+"&length="+this.rain_length+"&trans="+this.rain_vis+"&width="+this.rain_width+"&image="+this.toolbox.image_layer.img.attr("src")},getData:function(){var a=this;var b={rotation:a.rotation};return b},postLoadEditor:function(){this.rain_intens=$("#rain_intens").val();this.rain_length=$("#rain_length").val();this.rain_vis=$("#rain_vis").val();this.rain_width=$("#rain_width").val();this.showBase();this._animateRain();this.setInitialPosition()},destroy:function(){this.timeout=0;this.image.remove();this.wrapper.remove();this._super()}});Layer("ExpandCanvas",{directions:[["se","s","sw"],["e","","w"],["ne","n","nw"]]},{init:function(a){this.toolbox=a;this.src_image=a.image_layer;this.cur_row="1";this.cur_col="1";this.trans=true;this.imgData=this.src_image.getData();return this},change:function(a){var b=a.attr("id");if(b.indexOf("pos-")==0){this.setMatrix(b)}else{if(b=="widthC"){this._changeWidth(a)}else{if(b=="heightC"){this._changeHeight(a)}else{if(b=="bg_trans"){return this.colorVis(a)}else{if(b=="fg_color"){return this.setColor(a)}}}}}this.setPosition()},setColor:function(){var b=$("#fg_color").spectrum("get");var a=b.toHex(true);this.src_image.div.css("background","#"+a)},removeColor:function(){this.src_image.div.css("background","transparent")},colorVis:function(a){this.trans=a.is(":checked");if(this.trans){$("#tbFgColor").hide();this.removeColor()}else{$("#tbFgColor").show();this.setColor()}},setPosition:function(){var b=((this.width-this.imgWidth)/2)*parseInt(this.cur_col);var a=((this.height-this.imgHeight)/2)*parseInt(this.cur_row);this.src_image.div.width(this.width);this.src_image.div.height(this.height);$("#img").css("top",a);$("#img").css("left",b)},_changeWidth:function(a){this.width=a.val();this.src_image.div.width(a.val());this.src_image._centerElement()},_changeHeight:function(a){this.height=a.val();this.src_image.div.height(a.val());this.src_image._centerElement()},setMatrix:function(h){var d="ui-icon-arrowthick-1-";var c=$(".direction").attr("class").split(" ").filter(function(j){return j.lastIndexOf(d,0)!==0});$(".direction").attr("class",c.join(" "));var f=parseInt(h.replace("pos-","")[0]);var b=parseInt(h.replace("pos-","")[1]);var g=this.Class.directions;for(i_row=0;i_row<g.length;i_row++){for(i_col=0;i_col<g[i_row].length;i_col++){var e=f-i_row+1;var a=b-i_col+1;if(e>=0&&a>=0){$("#pos-"+e+a).addClass(d+g[i_row][i_col])}}}this.cur_row=f;this.cur_col=b},postLoadEditor:function(){var c=this.imgData;var b=Math.floor(c.width*1.1);var a=Math.floor(c.height*1.1);$("#widthC").val(b);$("#heightC").val(a);this.imgWidth=c.width;this.imgHeight=c.height;this.width=b;this.height=a;$("#img").css("position","relative");$("#bg_trans").prop("checked","checked");this.setPosition()},getData:function(){var a=this;var b={row:a.cur_row,col:a.cur_col,trans:a.trans};return b},destroy:function(){var a=this.imgData;this.src_image.div.height(a.width);this.src_image.div.height(a.height);this.removeColor();$("#img").css("position","static")},});$.Class("Storage",{editors:{create_text:"font,size,fg_color,bg_color,strokewidth,arc_val,arc_flip,rotation,shadow_color,shadow_blur,show_shadow,shadow_fall,line_space,kerning,text_props"}},{init:function(){this.engine=$.localStorage;this.bindings()},bindings:function(){this.editors=Storage.editors},custom_show:function(a){},getValues:function(c){var b=this;var a=b.editors[c].split(",");var d={};$.each(a,function(e,f){b.setFieldValue(f,d)});b.layer.getStorageValues(d);return d},do_store:function(b){var a=$("#save_name").val();var c=this.getValues(b);c.timestamp=$.now();var d=$.localStorage;d.set(b,a,c);this.display.dialog("close");return true},getStoredValues:function(a){var c=$.localStorage;var b="";if(a==undefined){b=c.keys(this.tool)}else{b=c.get(this.tool,a)}return b},doAction:function(c,b){var a=this;var d=c.attr("id");if(d=="save"){return a.do_store(b)}if(d=="restore"){a.do_restore(b)}},do_restore:function(){var a=$("#save_select").val();var b=this.getStoredValues(a);this.restore(b)},restore:function(c){var a=this;var b={};$.each(c,function(f,e){var d=a.restoreField(f,e);if(d==false){b[f]=e}});this.layer.refresh(b)},setShadowProps:function(d){var c=this.layer;var a={};var b=this;$.each(d,function(g,f){var e=b.restoreField(g,f);if(e==false){a[g]=f}});return a},restoreColor:function(c,b){var a=tinycolor(b.color).toRgb();a.a=b.alpha;c.spectrum("set",a);app.toolbox._colorOpacityChanged(c,c.spectrum("get"))},restoreField:function(c,b){var a=$("#"+c);if(a.hasClass("colorSlider")){this.restoreColor(a,b)}else{if(a.is(":checkbox")){a.prop("checked",b)}else{if(a.is("select")){this.restoreSelect(c,b)}else{if(a.is(":radio")){this.restoreRadio(c,b)}else{if(a.is(":input")){a.val(b)}else{return false}}}}}},restoreRadio:function(b,a){$("input:radio[name="+b+'][value="'+a+'"]').prop("checked",true)},restoreSelect:function(e,c){var b=c.internalName;var a=c.externalName;var d=$("#"+e+" option[value='"+b+"']").length>0;if(d!=true){$("#"+e).append("<option value='"+b+"'>"+a+"</option>")}$("#"+e).val(b)},setFieldValue:function(e,c){var d=$("#"+e);var b="";if(d.hasClass("colorSlider")){var a=d.spectrum("get");b={color:a.toHex(true),alpha:a.alpha}}else{if(d.is("select")){b={internalName:d.val(),externalName:$("#"+e+" option:selected").text()}}else{if(d.is(":checkbox")){b=d.prop("checked")}else{if(d.is(":radio")){b=$("input[name="+e+"]:checked").val()}else{b=d.val()}}}}c[e]=b},action:function(d,b,c){var a=this;if(!d.hasClass("storage")){return}if(a.doAction(d,b)){return}if(a.display){return a.display.dialog("open")}a.display=$("<div id='storage-dialog'></div>");a.layer=c;a.tool=b;app.getHTML("editor","storage",function(e){a.initDialog(e)})},initDialog:function(a){var b=this;b.display.html(a);b.display.dialog({height:"auto",width:"auto",modal:false,open:function(c,d){b.dialogOpen()}})},dialogOpen:function(){app.toolbox._bindActions("#storage-dialog");$("#save_select").empty();var a=this.getStoredValues();$.each(a,function(c,b){$("#save_select").append("<option value='"+b+"'>"+b+"</option>")})},show:function(a){if(this.editors[a]==undefined){return false}$("#tbStorage").show();this.custom_show(a)}});$.Class("Settings",{chkr:"sm",chkr_c:"gr",bkgr:"ffffff",init:function(){$.cookie.json=true;var a=$.cookie("settings");if(a){this.chkr=a.chkr;this.chkr_c=a.chkr_c;this.bkgr=a.bkgr}this._refreshCanvas()},show:function(){var a=this;if(a.display){return a.display.dialog("open")}a.display=$("<div id='settings-dialog'></div>");app.getHTML("editor","settings",function(b){a.initDialog(b)})},initDialog:function(a){var b=this;b.display.html(a);b.display.dialog({height:"auto",width:"auto",modal:false,open:function(c,d){b._bindActions("#settings-dialog"),b.postInitDialog()},position:{my:"right top",at:"left bottom",of:$("#settings")}})},postInitDialog:function(){$("#chkr").val(this.chkr);$("#chkr_c").val(this.chkr_c);$("#color3").spectrum("set",this.bkgr)},change:function(a){if(!a.hasClass("setting")){return}var b=a.attr("id");if(b=="chkr"||b=="chkr_c"){this._setChecker()}else{if(b=="color3"){this._setBgColor()}else{if(b=="save"){this._saveSettings()}else{if(b=="default"){this._defaultSettings()}}}}},_defaultSettings:function(){this.chkr="sm";this.chkr_c="gr";this.bkgr="ffffff";this._refreshCanvas();this._saveSettings()},_saveSettings:function(){var a={chkr:this.chkr,chkr_c:this.chkr_c,bkgr:this.bkgr};$.cookie("settings",a,{expires:365,path:"/"});this.display.dialog("close")},_setChecker:function(){this.chkr=$("#chkr").val();this.chkr_c=$("#chkr_c").val();this._refreshCanvas()},_refreshCanvas:function(){var a="none";if(this.chkr_c!="none"){a="chkr_"+this.chkr+"_"+this.chkr_c}$("#canvas").removeClass();$("#canvas").addClass(a);$("#canvas").css("background-color","#"+this.bkgr)},_setBgColor:function(){var a=$("#color3").spectrum("get");this.bkgr=a.toHex(true);this._refreshCanvas()},_bindActions:function(){app.toolbox._bindActions("#settings-dialog")}},{});Settings.init();$(document).ready(function(){$("a.bkmrk").click(function(c){c.preventDefault();var b=$(location).attr("href");var a=document.title;if(window.sidebar){window.sidebar.addPanel(a,b,"")}else{if(window.external||document.all){window.external.AddFavorite(b,a)}else{if(window.opera){$("a.bkmrk").attr("href",b);$("a.bkmrk").attr("title",a);$("a.bkmrk").attr("rel","sidebar")}else{alert("Please hold CTRL+D and click the link to bookmark it in your browser.");return false}}}})});(function($){var escape=/["\\\x00-\x1f\x7f-\x9f]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},hasOwn=Object.prototype.hasOwnProperty;$.toJSON=typeof JSON==="object"&&JSON.stringify?JSON.stringify:function(o){if(o===null){return"null"}var pairs,k,name,val,type=$.type(o);if(type==="undefined"){return undefined}if(type==="number"||type==="boolean"){return String(o)}if(type==="string"){return $.quoteString(o)}if(typeof o.toJSON==="function"){return $.toJSON(o.toJSON())}if(type==="date"){var month=o.getUTCMonth()+1,day=o.getUTCDate(),year=o.getUTCFullYear(),hours=o.getUTCHours(),minutes=o.getUTCMinutes(),seconds=o.getUTCSeconds(),milli=o.getUTCMilliseconds();if(month<10){month="0"+month}if(day<10){day="0"+day}if(hours<10){hours="0"+hours}if(minutes<10){minutes="0"+minutes}if(seconds<10){seconds="0"+seconds}if(milli<100){milli="0"+milli}if(milli<10){milli="0"+milli}return'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"'}pairs=[];if($.isArray(o)){for(k=0;k<o.length;k++){pairs.push($.toJSON(o[k])||"null")}return"["+pairs.join(",")+"]"}if(typeof o==="object"){for(k in o){if(hasOwn.call(o,k)){type=typeof k;if(type==="number"){name='"'+k+'"'}else{if(type==="string"){name=$.quoteString(k)}else{continue}}type=typeof o[k];if(type!=="function"&&type!=="undefined"){val=$.toJSON(o[k]);pairs.push(name+":"+val)}}}return"{"+pairs.join(",")+"}"}};$.evalJSON=typeof JSON==="object"&&JSON.parse?JSON.parse:function(str){return eval("("+str+")")};$.secureEvalJSON=typeof JSON==="object"&&JSON.parse?JSON.parse:function(str){var filtered=str.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+str+")")}throw new SyntaxError("Error parsing JSON, source is not valid.")};$.quoteString=function(str){if(str.match(escape)){return'"'+str.replace(escape,function(a){var c=meta[a];if(typeof c==="string"){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+str+'"'}}(jQuery));(function(b){b.support.touch="ontouchend" in document;if(!b.support.touch){return}var d=b.ui.mouse.prototype,f=d._mouseInit,c=d._mouseDestroy,a;function e(h,j){if(h.originalEvent.touches.length>1){return}h.preventDefault();var k=h.originalEvent.changedTouches[0],g=document.createEvent("MouseEvents");g.initMouseEvent(j,true,true,window,1,k.screenX,k.screenY,k.clientX,k.clientY,false,false,false,false,0,null);h.target.dispatchEvent(g)}d._touchStart=function(h){var g=this;if(a||!g._mouseCapture(h.originalEvent.changedTouches[0])){return}a=true;g._touchMoved=false;e(h,"mouseover");e(h,"mousemove");e(h,"mousedown")};d._touchMove=function(g){if(!a){return}this._touchMoved=true;e(g,"mousemove")};d._touchEnd=function(g){if(!a){return}e(g,"mouseup");e(g,"mouseout");if(!this._touchMoved){e(g,"click")}a=false};d._mouseInit=function(){var g=this;g.element.bind({touchstart:b.proxy(g,"_touchStart"),touchmove:b.proxy(g,"_touchMove"),touchend:b.proxy(g,"_touchEnd")});f.call(g)};d._mouseDestroy=function(){var g=this;g.element.unbind({touchstart:b.proxy(g,"_touchStart"),touchmove:b.proxy(g,"_touchMove"),touchend:b.proxy(g,"_touchEnd")});c.call(g)}})(jQuery);